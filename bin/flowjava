#!/bin/bash

set -e

SCRIPT_DIR=$( cd "$( dirname "$0" )" && pwd -P )

BASE_DIR=$( cd "$( dirname "$SCRIPT_DIR" )" && pwd -P )
BUILD_DIR=$BASE_DIR/platforms/java/build

LIBS=$BASE_DIR/platforms/java/lib/Java-WebSocket-1.3.9.jar

# Compile the runtime
pushd "$BASE_DIR/platforms/java"
javac -d "$BUILD_DIR" -classpath "$LIBS" -g com/area9innovation/flow/*.java com/area9innovation/flow/websocket/*.java javafx/com/area9innovation/flow/javafx/*.java
popd

# Generate the Java for our program
flow --java javagen "$@"

# Compile the generated code
javac -Xlint:unchecked -encoding UTF-8 -cp "$BUILD_DIR" javagen/*.java

# Run the program!
java -cp "$LIBS":"$BUILD_DIR":. com.area9innovation.flow.javafx.FxLoader
