#!/bin/bash

set -e

SCRIPT_DIR=$( cd "$( dirname "$0" )" && pwd -P )

BASE_DIR=$( cd "$( dirname "$SCRIPT_DIR" )" && pwd -P )

echo ""
echo "Compiling 'Flowc2' - the c++ built executable"
echo "============================================="
echo ""

echo "* Preparing version information"
echo "  -----------------------------"
echo ""

cat <<EOF > "$BASE_DIR/tools/flowc/flowc_version.flow"
// This file is autogenerated.
// Edit 'build-flowc' or 'build-flowc2' instead.
export {
	flowc_version = "$(cat "$BASE_DIR/tools/flowc/flowc.version")";
	flowc_git_revision = "$(git rev-parse --short HEAD)";
	flowc_build_time = "$(date +"%D %T")";
}
EOF

flowc2 cpp2=flowc_1 tools/flowc/flowc.flow verbose=1
mv flowc_1 $BASE_DIR/tools/flowc/flowc
