<link rel="stylesheet" type="text/css" media="screen" href="style.css?v1" />
<h1>Flow: getting started (on Windows)</h1>

<h2>Setup &amp; compile the haxe-based flow compiler</h2>

<p>First, download and install haXe and neko:</p>

<pre><code>http://haxe.org/download/
</code></pre>

<p>Haxe 3.4.* should work, but you'll have to manually roll back neko version to 2.0.0 
(see section below). The simplest way is to get haxe 3.2.1.</p>

<p>Now install the "format" and "pixijs" haxe libraries:</p>

<pre><code>haxelib install format
haxelib set pixijs 4.5.4
(a newer version might be not supported yet)
</code></pre>

<p>Now check that you can compile the compiler:</p>

<pre><code>cd c:\flow9\src
haxe FlowNeko.hxml
</code></pre>

<p>Also to go to <code>C:\flow9\resources\neko\1.8.2-2.0.0</code>. Move the patched gc.dll
to your Neko installation (there is a readme.txt in that folder with a little more detail).
This will increase the amount of available memory to Neko, to avoid errors when
compiling larger Flow programs.</p>

<h1>Using haxe 3.4.x or later</h1>

<p>It is possible to use later Haxe versions, but you have to revert back to neko 2.0.0 to
make this work.</p>

<p>First, install Haxe with the neko 2.1. Then, go to <code>...\HaxeToolkit\</code> folder
where you installed Haxe and neko. You need to extract the
<code>flow9\resources\neko\neko-2.0.0-win.zip</code> file in this folder. Then you should copy the
<code>flow9\resources\neko\1.8.2-2.0.0\unlimited\gc.dll</code> on top of the one in the
neko-2.0.0 folder.
Now, rename the "neko" folder to "neko-2.1.0", and rename "neko-2.0.0" to "neko".
Restart any command prompts, and you should be able to use the latest haxe with
neko 2.0, with the unlimited heap.</p>

<p>At the end, you will have</p>

<ul>
<li>...\HaxeToolkit\haxe</li>
<li>...\HaxeToolkit\neko-2.1        (unused)</li>
<li>...\HaxeToolkit\neko            (with neko 2.0)</li>
<li>...\HaxeToolkit\neko\gc.dll     (taken from <code>flow9\resources\neko\1.8.2-2.0.0\unlimited\gc.dll</code>)</li>
</ul>

<p>Verify that you can compile and run programs, and you are all set.</p>

<h1>Install VC runtime</h1>

<p>Run
    C:\flow9\QtByteRunner\bin\windows\vcredist_x64.exe</p>

<p>to install the Visual Studio runtime needed for our flow bytecode runner.</p>

<h1>Install Java 8 or later in a 64-bit version</h1>

<p>This is required to run the flowc compiler.</p>

<h2>Add flow to your PATH</h2>

<p>Now you are ready to start use flow. First add <code>c:\flow9\bin</code> to your PATH.</p>

<p>Now test that everything works by compiling &amp; running the first program using
the c++ runner in a command line at <code>c:/flow9</code>:</p>

<pre><code>flowcpp sandbox/hello.flow
</code></pre>

<p>If it prints "Hello console" in your console and "Hello window" on the screen, <em>flow</em> is alive.</p>

<h2>Compile flow to JS and serve it from a web server</h2>

<p>You can also run flow code in JavaScript, served by a web server. First set up a web-server such
that <code>http://localhost/flow/</code> points to the <code>/flow9/www</code> directory.</p>

<p>If you want to develop on Windows, you can do that using WampServer (preferred) or EasyPHP</p>

<pre><code>http://www.wampserver.com/
http://www.easyphp.org/
</code></pre>

<p>When installing WampServer or EasyPHP on Windows 8 or later, run the installer as administrator.</p>

<p>Make sure you configure your Skype to not use port 80 in Settings, Advanced, Connection
and uncheck the check box for using port 80 and 443. In Wamp, next "Start all services".
Now add an alias by selecting Apache, Alias directories, Add an alias, and make "flow"
point to <code>c:/flow9/www</code>.</p>

<p>For EasyPHP, go to the administration, under LOCAL FILES click "add an alias" to make 
"flow" point to <code>c:/flow9/www</code>. Notice, however, recent versions of EasyPHP
like to put an "edsa-" prefix to all alias, which is very annoying. To work around that,
you have to hack the http.conf setup manually.</p>

<pre><code>    Alias /flow/ "C:/flow9/www/"

    &lt;Directory "C:/flow9/www/"&gt;
            Options Indexes FollowSymLinks MultiViews
            AllowOverride all
            Order allow,deny
            Allow from all
            Require all granted
    &lt;/Directory&gt;
</code></pre>

<p>There is another way to fix "edsa-" prefix
(https://stackoverflow.com/questions/39339513/how-to-prevent-easyphp-devserver-16-to-add-prefix-edsa-for-alias).
Go to the eds-dashboard subdirectory and edit the index.php file.</p>

<p>Change:
    $new<em>alias[0]['alias</em>name'] = 'edsa-' . $<em>POST['alias</em>name'];
    <?php echo wordwrap(substr($alias['alias_name'],5), 20, "<br />", true); ?></p>

<p>For:
    $new<em>alias[0]['alias</em>name'] = $<em>POST['alias</em>name'];
    <?php echo wordwrap(substr($alias['alias_name'],0), 20, "<br />", true); ?></p>

<p>Because of this mess, we recommend Wamp instead.</p>

<p>Now you can compile your code to JavaScript like</p>

<pre><code>flowc1 sandbox/hello.flow js=www/hello.js
</code></pre>

<p>or using the older, haxe-based compiler:</p>

<pre><code>flow --js www/hello.js sandbox/hello.flow
</code></pre>

<p>Then open this in your web browser:</p>

<pre><code>http://localhost/flow/flowjs.html?name=hello
</code></pre>

<p>To see the output from this program, open the JavaScript console in your
browser. That is ctrl+shift+J in Chrome in the address line.</p>

<h2>What is really happening when compiling flow code</h2>

<p>When you run</p>

<pre><code>flowcpp sandbox/hello.flow
</code></pre>

<p>the program will be compiled to flow bytecode and then interpreted.
You can also do this manually like this. First compile to bytecode
with a command line like this:</p>

<pre><code>flowc1 sandbox/hello.flow bytecode=hello.bytecode
</code></pre>

<p>or with the haxe-based compiler like:</p>

<pre><code>flow -c hello.bytecode sandbox/hello.flow
</code></pre>

<p>Next, you can interpret that by the C++ runner by typing</p>

<pre><code>flowcpp hello.bytecode
</code></pre>

<p>in a command prompt in <code>c:\flow9</code>. This will use the Qt-based C++ flow runner.
See <code>QtBytecodeRunner/readme.txt</code> to learn more about this runner.</p>

<p>As you saw above, you can also compile directly to JavaScript by using</p>

<pre><code>flowc1 sandbox/hello.flow js=www/hello.js
</code></pre>

<p>or</p>

<pre><code>flow --js hello.js sandbox/hello.flow
</code></pre>

<p>and run it as</p>

<pre><code>http://localhost/flow/flowjs.html?name=hello
</code></pre>

<p>Currently, we use the <a href="https://pixijs.io">PixiJs</a> rendering library to draw our 
js-compiled applications.</p>

<p>Please note that js target won't run any code unless you render something.</p>

<h2>Why use PixiJs instead of DOM?</h2>

<p>We tried to use DOM for rendering, but as a result we got huge DOM trees and browsers were unable to handle them and just kept crashing.
With PixiJs we render everything in one canvas and it can handle and reflect complicated UI trees quite well compared to DOM implementation.</p>

<h2>Sending emails</h2>

<p>To be able to send email from your local machine, you should install the SSL certificate.
Though on Windows they are usually installed into the registry, in PHP this is done
by editing the file <code>php.ini</code>.</p>

<p>Download the following file: http://curl.haxx.se/ca/cacert.pem to any folder on your
hard drive. In the file <code>php.ini</code>, find a line</p>

<pre><code>openssl.cafile=
</code></pre>

<p>If it is commented, uncomment it and append the full path of the downloaded file <code>cacert.pem</code>.</p>

<h2>Compiling and running flow bytecode as CGI scripts in apache</h2>

<p>Information on this topic can be found in QtByteRunner/readme.md
in section "Enabling fast-cgi in apache"</p>

<h2>Running in a virtual environment?</h2>

<h3>Running Windows guest under VMWare</h3>

<p>VMWare with Windows guest seems to be fully functional, including C++ Runner, thanks to 3D support from VMWare.</p>

<h3>Running Windows guest under VirtualBox</h3>

<p>VirtualBox with Windows guest support is limited to non-gui mode of C++ runner. All other stuff works fine though.</p>

<p>Running GUI programs with the C++ runner may fail with the error <em>"OpenGL ARB_framebuffer_object extension is not available"</em>.
In that case, you can still use the runner for command-line programs by running it with <code>flowcpp --batch</code>.
For testing GUI code, use JavaScript instead.</p>
