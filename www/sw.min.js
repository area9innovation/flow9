var CACHE_NAME="flow-cache",rangeResourceCache="flow-range-cache",dynamicResourcesExtensions=[".php",".serverbc"],CacheMode={PreferCachedResources:!1,CacheStaticContent:!0};function initializeCacheStorage(){return caches.open(CACHE_NAME).then(function(e){return console.log("Opened cache"),Promise.resolve()})}self.addEventListener("install",function(e){e.waitUntil(initializeCacheStorage())}),self.addEventListener("fetch",function(a){var r=function(t){a.clientId&&setTimeout(function(){clients.get(a.clientId).then(function(e){e.postMessage(t)})},5)},c=function(){if(!a.clientId)return Promise.reject();var n=new URL(a.request.url);return clients.get(a.clientId).then(function(e){var t=new URL(e.url);return n.pathname.endsWith("/php/stamp.php")&&n.searchParams.get("file")==t.searchParams.get("name")+".js"?Promise.resolve():Promise.reject()})},e=function(e){return caches.match(a.request,{ignoreSearch:e}).then(function(e){return e?(r({msg:"Responded with cache:",url:a.request.url}),e):Promise.reject()})},t=function(){return c().then(function(){return e(!0)}).catch(function(){return e(!1)})},n=function(){return fetch(a.request).then(function(t){if(CacheMode.CacheStaticContent&&200==t.status&&"basic"==t.type){var n=new URL(a.request.url);return Promise.all(dynamicResourcesExtensions.map(function(e){return n.pathname.endsWith(e)?c().then(function(){return caches.open(CACHE_NAME).then(function(e){return e.delete(self.registration.scope+"php/stamp.php",{ignoreSearch:!0}).then(function(){return e.delete(self.registration.scope+n.searchParams.get("file"),{ignoreSearch:!0})})})}):Promise.resolve()})).then(function(){return caches.open(CACHE_NAME).then(function(e){e.put(a.request,t),r({msg:"Cached resource:",url:a.request.url})}),t.clone()}).catch(function(){return t})}return t})};a.request.headers.get("range")?a.respondWith(caches.open(rangeResourceCache).then(function(e){return e.match(a.request.url)}).then(function(e){return e||fetch(a.request).then(function(e){if(200!=e.status)return e;var t=e.clone();return caches.open(rangeResourceCache).then(function(e){return e.put(a.request,t)}).then(function(){return e})})}).then(function(c){return 200==c.status?c.arrayBuffer().then(function(e){var t=/^bytes\=(\d+)\-(\d+)?$/g.exec(a.request.headers.get("range"));if(t){var n=Number(t[1]),r=Number(t[2])||e.byteLength-1;return new Response(e.slice(n,r+1),{status:206,statusText:"Partial Content",headers:[["Content-Type",c.headers.get("Content-Type")],["Content-Range","bytes "+n+"-"+r+"/"+e.byteLength]]})}return new Response(null,{status:416,statusText:"Range Not Satisfiable",headers:[["Content-Range","*/"+e.byteLength]]})}):c})):a.respondWith(CacheMode.PreferCachedResources?t().catch(function(){return n()}):n().catch(function(){return t()}))}),self.addEventListener("activate",function(e){caches.delete(rangeResourceCache),console.log("cache cleared",rangeResourceCache),caches.keys().then(function(e){return Promise.all(e.map(function(e){if(CACHE_NAME!=e)return caches.delete(e)}))})}),self.addEventListener("message",function(n){var t=function(e){0<n.ports.length?n.ports[0].postMessage(e):console.error("Failed to respond!")},e=function(e){e.then(function(){t({status:"OK"})}).catch(function(){t({status:"Failed"})})};"get_cache_version"==n.data.action?t({cache_version:SW_CACHE_VERSION}):0<n.data.action.indexOf("_cache_resources")?e(caches.open(CACHE_NAME).then(function(t){return Promise.all(n.data.urls.map(function(e){return"add_cache_resources"==n.data.action?t.add(e):"remove_cache_resources"==n.data.action?t.delete(e):void 0}))})):"get_cache_storage_names"==n.data.action?caches.keys().then(function(e){t({names:e})}):"remove_cache_storage"==n.data.action&&e(caches.delete(n.data.action.name))});