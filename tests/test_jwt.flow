import jwt;

// To run the test use java: build-jar tests/test_jwt.flow --run
main() {
	keyPemRSA = "
		-----BEGIN PUBLIC KEY-----
		MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA6S7asUuzq5Q/3U9rbs+P
		kDVIdjgmtgWreG5qWPsC9xXZKiMV1AiV9LXyqQsAYpCqEDM3XbfmZqGb48yLhb/X
		qZaKgSYaC/h2DjM7lgrIQAp9902Rr8fUmLN2ivr5tnLxUUOnMOc2SQtr9dgzTONY
		W5Zu3PwyvAWk5D6ueIUhLtYzpcB+etoNdL3Ir2746KIy/VUsDwAM7dhrqSK8U2xF
		CGlau4ikOTtvzDownAMHMrfE7q1B6WZQDAQlBmxRQsyKln5DIsKv6xauNsHRgBAK
		ctUxZG8M4QJIx3S6Aughd3RZC4Ca5Ae9fd8L8mlNYBCrQhOZ7dS0f4at4arlLcaj
		twIDAQAB
		-----END PUBLIC KEY-----
	";
	keyJsonRSA = <<{
		"kty": "RSA",
		"n": "6S7asUuzq5Q_3U9rbs-PkDVIdjgmtgWreG5qWPsC9xXZKiMV1AiV9LXyqQsAYpCqEDM3XbfmZqGb48yLhb_XqZaKgSYaC_h2DjM7lgrIQAp9902Rr8fUmLN2ivr5tnLxUUOnMOc2SQtr9dgzTONYW5Zu3PwyvAWk5D6ueIUhLtYzpcB-etoNdL3Ir2746KIy_VUsDwAM7dhrqSK8U2xFCGlau4ikOTtvzDownAMHMrfE7q1B6WZQDAQlBmxRQsyKln5DIsKv6xauNsHRgBAKctUxZG8M4QJIx3S6Aughd3RZC4Ca5Ae9fd8L8mlNYBCrQhOZ7dS0f4at4arlLcajtw",
		"e": "AQAB",
		"kid": "test-rsa"
	}
	>>;

	verifyRSA = \jwt, algorithm -> {
		res1 = verifyJwtWithPublicKey(jwt, keyPemRSA, algorithm);
		res2 = verifyJwtWithPublicKey(jwt, keyJsonRSA, algorithm);
		println(algorithm + " PEM format: " + res1);
		println(algorithm + " JSON format: " + res2);
	}

	verifyRSA(
		"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTcyNTUzNjQyNywiZXhwIjoxNzI1NTQwMDI3fQ.bJGDuds4iiY_HcRUA7Sv5DL8LPCEB7Q5QchAcyNRLwgB_EqdG3Lj4thwpficv_-ZMLwmTM6MiRr1Ik1M_KLDpLAo7u2r5jBYnemvUwEScKQ1LBkQbjkEzWsJ4WMlqf9YbG93BAR87PLAy09VhUmmCgDhJlaX3abyWsfKumuE7a5vDrG_KN2FgIqggmAYAVEiynZoCk06uzmY0OkumELsuME1zOiFUkVJPpOGPZijV_wjQN1fBHgOqwuLxMnpW8NU1XSROvOWumJkZuN_T0SKoG6Ebb0tE_7Ji_iow3bRahj-Fz1WFDZb3Kd80kbCRPBsdtPByUB_9R1QdftWpIcBaw",
		"RS256"
	);
	verifyRSA(
		"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzM4NCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTcyNTUzNjQyNywiZXhwIjoxNzI1NTQwMDI3fQ.y7pxWYhPiSKPl-xZQumUu66Zq35OEpHCoGRC8eZnwTFoElptc1O4wf0grKlBT8kKrVjbKLcZUYw6qVoxDGw-InU3rRqKX1Goz5qFHFApd_6QGqEypmc6wpEY_8YIDm8WXFopav-bCMd6ra2-h9EKoU6ADTTpWCYuLpCdIA7ZKaQk3KdVqML446MLv2uoZvPfONiw02RTpdezxGXIV9-xJi_1y0qsuOEVgKFpk1YG0w01R-aiBbT46qnuXs3W2R3k8KsKDJfE3F6icK-qOFM18-7Lht3y2c2_AmBD3z72F-4Y18p0uIg0knxf_MX7oSTzPWSK7Cx1ECNoFbMcZuAF4Q",
		"RS384"
	);
	verifyRSA(
		"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzUxMiJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTcyNTUzNjQyNywiZXhwIjoxNzI1NTQwMDI3fQ.43xvbZzGtmdSDXeZ0iT6lhr5WE8QZ2rUZ4NWsaLpXGcNy5ko29yfulAUBWShVR3Hf8Jw51QUnR8YeqMvKRHtAKv0xpHe8cMYfLLAFGfxPEf7Q8IiHErt_Ux9dNIfMH4ZZZO5iZOv0qZUodUX7nWUixaFo0zNjQUQ3mQH0zDxBoUp4sntTBCduECKdDXVKW8jm1NLKel-r21cOASv8RADe87Bm0BwerCL481D4vzjC5WTr30CSdq8bkIF5sGR_In7FojrFs5r7RrmxexoVvbGVbp444sgW9-lfx703XP--Mt6bKO6EjCkP1P6SlcSp_A6IWuU1cgJdqTL4xkmNPXJFQ",
		"RS512"
	);

	quit(0);
}
