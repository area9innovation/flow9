import material/material;
import material/form2material;
import material/material2tropic;
import tropic/tropictransforms;

loadingScreenIconSize = 48.0;
iconSize = 40.0;

entry(m2t: (Material, MFocusGroup) -> Tropic, fg: MFocusGroup, xal: double, alignStr: string, para: bool) {
	width = make(0.0);
	widthManager = dummyParagraphWidthManager;
	//widthManager = ParagraphWidthManager(width, width, false);
	MColsA([
		if (para) form2material(renderParagraph([
			TextFragment(_("Paragraph to"), MTextStyle2CharacterStyle(fg, [MRed(900), MCustomFont(20.0, "RobotoMedium", 0.87)])),
			TextFragments(Cons(NewLine(), EmptyList())),
			TextFragment(alignStr+" "+alignStr+" "+alignStr, MTextStyle2CharacterStyle(fg, [MRed(900), MBodyBold()]))],[
			TightWidth(), StartAlign()],
			fg.rtl,
			widthManager
		)) else MText("Simple text", [MRed(900), MCustomFont(20.0, "RobotoMedium", 0.87)]),
		MIcon("local_library", [MRed(900), MIconSize(loadingScreenIconSize)]),
		MLetterIcon("<>", [MIconSize(iconSize), FillOpacity(1.)], [MCustomFont(iconSize / 2.2, "Roboto", 1.0)]),
		//MFillX(),
		//tweak(MFixedX(56.0), MBorderA(-8.0, -8.0, 8.0, -8.0, MIcon("local_library", [MRed(900), MIconSize(loadingScreenIconSize)]))),
	])
	|> (\c -> MTweak([TAlign(const(xal), zero)], c, TFillX()))
	|> (\c -> m2t(c, fg))
}

main() {
	manager = makeMaterialManager([]);
	setLang("en");

	tweak = \w, m -> MTweak([TAlign(const(0.5), zero)], m, w);

	lines = \rtl ->
		MGetFocusGroup(\ofg -> {
			fg = MFocusGroup(ofg with rtl=rtl);

			MGetMaterial2Tropic(\m2t -> MDebug(if (rtl) 0xFF0000 else 0x00FF00, MLinesA([
				entry(m2t, fg, 0.0, "left", false),
				entry(m2t, fg, 0.0, "left", true),
				entry(m2t, fg, 0.5, "center", false),
				entry(m2t, fg, 0.5, "center", true),
				entry(m2t, fg, 1.0, "right", false),
				entry(m2t, fg, 1.0, "right", true),
			])))
		});

	content1 = MLines2A(lines(false), lines(true)) |> MBorderLeftRight(64.0);
	content2 = MGetFocusGroup(\fg -> {
		MGetMaterial2Tropic(\m2t ->
			entry(m2t, fg, 0.5, "center", true),
		)
	});

	mrender(manager, true, content1) |> ignore;
}