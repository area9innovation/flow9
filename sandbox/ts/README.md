# Flow9 TypeScript Integration Test

This project demonstrates how to integrate Flow9 code with TypeScript, including complete type safety, bundling, and minification.

## Overview

This test case shows:

1. **Flow9 Code**: `flow_export.flow` exports a `Foo` struct and functions
2. **Generated Types**: TypeScript `.d.ts` files generated by the Flow compiler
3. **TypeScript Integration**: TypeScript code that imports and uses Flow exports with full type safety
4. **Build Pipeline**: Complete build system with bundling and minification

## Generated Files

### Flow Compilation
- `flow_export.js` - Compiled JavaScript from Flow code
- `types/` - Generated TypeScript definitions
  - `flow_export.d.ts` - Types for our exports
  - `maybe.d.ts` - Maybe type definitions
  - `index.d.ts` - Re-exports all types

### TypeScript Code
- `src/main.ts` - Main TypeScript program using Flow exports
- `src/flow-wrapper.ts` - Bridge between Flow JS and TypeScript types

## Project Structure

```
├── flow_export.flow          # Original Flow code
├── flow_export.js            # Compiled Flow JavaScript
├── compile.sh                # Flow compilation script
├── types/                    # Generated TypeScript definitions
│   ├── index.d.ts
│   ├── flow_export.d.ts
│   └── maybe.d.ts
├── src/                      # TypeScript source code
│   ├── main.ts
│   └── flow-wrapper.ts
├── dist/                     # Build output
│   ├── bundle.js             # Bundled code
│   └── bundle.min.js         # Minified bundle
├── package.json              # Dependencies and scripts
├── tsconfig.json             # TypeScript configuration
├── webpack.config.js         # Webpack bundling configuration
├── build.sh                  # Complete build script
└── test.js                   # Test runner
```

## Building and Running

### Prerequisites
- Node.js (v16 or later)
- npm
- Flow9 compiler (for recompiling Flow code)

### Quick Start

1. **Install dependencies**:
   ```bash
	 npm install
```

2. **Build everything**:
   ```bash
	 ./build.sh
```

3. **Run the program**:
   ```bash
	 node dist/bundle.js
```

4. **Run tests**:
   ```bash
	 node test.js
```

### Individual Build Steps

```bash
# Compile Flow code (generates JS and .d.ts files)
./compile.sh

# Type check TypeScript
npm run type-check

# Compile TypeScript
npm run compile

# Bundle with webpack
npm run bundle

# Minify
npm run minify

# Development mode (watch for changes)
npm run dev
```

## Features Demonstrated

### Type Safety
- Flow structs become TypeScript interfaces
- Functions are properly typed
- Compile-time type checking prevents errors

### Integration Pattern
- `flow-wrapper.ts` bridges Flow JS with TypeScript types
- Uses `require()` for Flow JS and `import type` for types
- Provides helper functions for creating Flow structs

### Build Pipeline
- TypeScript compilation with source maps
- Webpack bundling for Node.js target
- Terser minification for production
- ESLint for code quality

### Example Usage

```typescript
import { Foo, addFoo, getFoo, createFoo } from './flow-wrapper';

// Type-safe Foo creation
const foo: Foo = createFoo(42);

// Call Flow functions with type safety
addFoo(foo);
const currentFoo = getFoo();

console.log(currentFoo.a); // TypeScript knows this is a number
```

## Configuration Files

- **`tsconfig.json`**: TypeScript compiler options with strict type checking
- **`webpack.config.js`**: Bundles TypeScript with Flow JS for Node.js target
- **`.eslintrc.js`**: ESLint rules for TypeScript code quality
- **`package.json`**: Dependencies and build scripts

## Output Analysis

The build produces:
- **`dist/bundle.js`**: Complete bundled application
- **`dist/bundle.min.js`**: Minified version for production
- Source maps for debugging
- Type declarations for library usage

## Extending This Setup

To add more Flow exports:

1. Add exports to `flow_export.flow`
2. Recompile: `./compile.sh` 
3. Update `flow-wrapper.ts` to re-export new functions
4. Use in TypeScript with full type safety

This demonstrates a complete integration workflow from Flow9 to TypeScript with production-ready bundling and minification.