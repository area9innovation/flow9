import material/extra/raymarching/raymarching;

main() {
	setRendererType("html");

	spheres1 = RMTranslate(
		RMUnion2(
			RMMaterial(RMTranslate(RMSphere(1.), RMY(1.)), RMReflect(0xFFFF00, 0.5)),
			RMTranslate(
				RMUnion2(
					RMMaterial(RMTranslate(RMSphere(0.5), RMX(2.)), RMColor(0xFF00FF)),
					RMMaterial(RMTranslate(RMSphere(0.5), RMX(-2.)), RMColor(0x00FFFF))
				),
				RMYZ(2., 2.)
			)
		),
		RMZ(3.)
	);

	spheres2 = RMUnion2(
		RMMaterial(RMSphere(0.5), RMColor(0x00FF00)),
		RMUnion2(
			RMMaterial(RMTranslate(RMSphere(0.5), RMX(2.)), RMColor(0x0000FF)),
			RMMaterial(RMTranslate(RMSphere(0.5), RMX(-2.)), RMColor(0xFF0000))
		),
	);

	//scene = const(RMTranslate(RMUnion2(spheres1, spheres2), RMZ(3.)));
	/*scene = RMUnion2(
		RMTranslate(RMUnion2(spheres1, spheres2), RMZ(3.)),
		RMMaterial(RMPlane(RMXYZ(0., 1., 0.)), RMColor(0xBBBBBB))
	);*/
	texture1B = make("");
	texture2B = make("");
	scene = fselect2(texture1B, texture2B, FLift2(\texture1, texture2 -> RMUnion([
		RMSmoothUnion([
			RMCompositeObject(RMSphere(0.5), "Sphere 2", RMColor(0x00FFFF), RMXYZ(-2., 2., 8.)),
			RMCompositeObject(RMSphere(0.5), "Sphere 3", RMColor(0x00FF00), RMXYZ(0., 0., 3.)),
			RMCompositeObject(RMSphere(0.5), "Sphere 4", RMColor(0x0000FF), RMXYZ(2., 0., 3.)),
			RMCompositeObject(RMSphere(0.5), "Sphere 5", RMColor(0xFF0000), RMXYZ(-2., 0., 3.)),
			RMCompositeObject(RMPlane(RMXYZ(0., 1., 0.)), "Ground Plane", RMReflect(0xFFFFFF, 0.8), RMXYZ(0., 0., 0.)),
			RMCompositeObject(RMSphere(1.), "Central sphere", RMReflect(0xFFFF00, 0.4), RMXYZ(0., 1., 6.)),
			RMCompositeObject(RMTorus(1., 0.3), "Torus", RMColor(0xDA8E1F), RMXYZ(-4., 2., 8.)),
		], 2.25),
		RMCompositeObject(RMBox(RMXYZ(0.3, 0.5, 1.)), "Box", RMTexture(makeDefaultRMTexture() with texture = texture1), RMXYZ(0., 4., 4.)),
		RMCompositeObject(RMRoundBox(RMXYZ(0.3, 0.5, 1.), 0.25), "Round Box", RMTexture(texture2, RMTextureTilingParameter(1., 2., 3., 3., 2., 1.), RMTextureTilingParameter(1., 2., 3., 3., 2., 1.), RMTextureTilingParameter(1., 2., 3., 3., 2., 1.), RMTextureTilingParameter(1., 2., 3., 3., 2., 1.)), RMXYZ(-2., 4., 4.)),
		//RMCompositeObject(RMPlane(RMXYZ(0., 1., 0.)), "Ground Plane", RMReflect(0xFFFFFF, 0.75), RMXYZ(0., 0., 0.)),
		RMCompositeObject(RMBoxFrame(RMXYZ(0.3, 0.5, 1.), 0.1), "Box Frame", RMTexture(makeDefaultRMTexture() with texture = "images/splash/splash_innovation_trans.png"), RMXYZ(2., 4., 4.)),
		RMSmoothUnion([
			RMCompositeObject(RMSphere(0.5), "Sphere 1", RMColor(0xFF00FF), RMXYZ(2., 2., 8.)),
			RMCompositeObject(RMCappedTorus(0.5, 0.3, 0.5), "Capped Torus", RMTexture(makeDefaultRMTexture() with texture = "images/splash/splash_innovation_trans.png"), RMXYZ(2., 2., 8.)),
		], 0.1),
		RMCompositeObject(RMCylinder(2., 0.5), "Cylinder", RMColor(0xAF4DCE), RMXYZ(-5., 5., 5.)),
		RMCompositeObject(RMRoundedCylinder(2., 0.5, 0.5), "Cylinder", RMColor(0xAFCD1E), RMXYZ(-5., 5., 3.)),
	])));

	/*light = RMPlus(
		RMPlus(
			RMTranslate(RMLightMaterial(RMLight(0.03), RMColor(0x00AAAA)), RMXYZ(-2., 8., 3.)),
			RMTranslate(RMLightMaterial(RMLight(0.05), RMColor(0xAA00AA)), RMXYZ(0., 8., 6.))
		),
		RMTranslate(RMLightMaterial(RMLight(0.07), RMColor(0xAAAA00)), RMXYZ(2., 8., 3.))
	);*/
	//light = RMTranslate(RMLightMaterial(RMLight(0.05), RMColor(0xFFFFFF)), RMXYZ(100., 100., 100.));
	light = RMCompositeLight(0.05, "Main light", RMColor(0xFFFFFF), RMXYZ(100., 100., 100.));
	
	camera = RMCamera(RMXYZ(6., 8., 6.), RMXYZ(0., 0., 6.));

	mrender(
		makeMaterialManager([]), true,
		MLines([
			makeRaymarchingMaterialTexture(MTextButton("SOME BUTTON", nop, [MButtonRaised(), MGreen(900)], []), texture1B),
			makeRaymarchingMaterialTexture(MTextButton("ANOTHER BUTTON", nop, [MButtonRaised(), MRed(900)], []), texture2B),	
			MDynamicRaymarching(0, scene, const(light), const(camera))
		])
	)
}
