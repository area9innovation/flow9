import binarytree;
import url_parameter;

export {
	SmartOption : (name : string);

	getSmartParameter(o : SmartOption) -> string;
	getSmartParameterDef(o : SmartOption, def : string) -> string;
	setSmartParameter(o : SmartOption, value : string) -> void;

	smartOptionsMap : ref Maybe<Tree<SmartOption, string>> = ref None();
}

getSmartParameter(o : SmartOption) -> string {
	getSmartParameterDef(o, "")
}

getSmartParameterDef(o : SmartOption, def : string) -> string {
	urlName = strRight(o.name, 3);
	if (getUrlParameter(urlName) != "")
		getUrlParameter(urlName)
	else eitherMap(
			^smartOptionsMap,
			\urlMap -> 
				lookupTreeDef(urlMap, o, def),
			def
		);
}

setSmartParameter(o : SmartOption, value : string) {
	smartOptionsMap := 
		eitherMap(
			^smartOptionsMap, 
			\urlMap -> Some(setTree(urlMap, o, value)),
			None()
		)
}