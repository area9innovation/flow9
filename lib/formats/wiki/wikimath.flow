// Â© Copyright 2012 Area9 Innovation. All rights reserved

import array;
import binarytree;
import formats/mathml;
import mathdrawingstructs;
import math;
import basecolors;
import formats/wiki/wikibracketedargs;

export {
	TeXLikeElement : (representation : string, type : TeXLikeExpression, args : Maybe<WikiArgsDescription>);
		TeXLikeExpression ::= MathSymbol, MathUserSymbol, UserSymbol, MathRoot, MathFrac, MathBracket, MathSum, MathProduct, MathIntegral,
							MathOverscript, MathUnderscript, MathDotted, MathScript, MathVariable, MathNaturalSyntax, MathLongDivision,
							MathSubscript, MathSuperscript, MathStrike, CustomSymbol, WikiSubSup,
							ParagraphNbsp, ConditionalWiki, WikiButton, PredefinedColor, WikiSlider, WikiForcedExpand, WikiSelect, WikiTimeline,
							WikiRepeat, WikiComboBox, MathNumber2String, WikiRotate, WikiScale, WikiMutable, WikiTopModificator,
							MathNumber2SciNot, WikiPicButton, MathNumber2SigDig, WikiDebug, WikiBlank, WikiBlank2, WikiScoringIcon, WikiWhen, WikiUnderline2,
							WikiScore, WikiCase, WikiEmpty, WikiDraggable, WikiDroptarget, WikiPopup, WikiLimiter, WikiMessagesCollector,
							WikiRadioButtons, WikiInlineBullet, WikiNewLine, WikiCalc, WikiAltTextCollector, MathUnknownConstruction, MathAssignmentsOnBecameVisible;
			MathSymbol  : (encoding : string, style : [MathSymbolStyle], type : MathMlType);
				MathSymbolStyle ::= ScriptFont, NaturalMathFont;
				ScriptFont : ();
				NaturalMathFont : ();
			MathUserSymbol : ();
			UserSymbol : ();
			ParagraphNbsp : ();
			MathRoot : ();
			MathFrac : ();
			MathBracket : ();
			MathSum : ();
			MathProduct : ();
			MathIntegral : ();
			MathOverscript : ();
			MathUnderscript : ();
			MathDotted : ();
			MathScript : ();
			MathVariable : ();
			MathNaturalSyntax : ();
			MathAssignmentsOnBecameVisible : ();
			MathLongDivision : ();
			MathSubscript : ();
			MathSuperscript : ();
			WikiSubSup : ();
			MathStrike : ();
			MathNumber2String : ();
			ConditionalWiki : (script : bool);
			WikiButton : ();
			WikiSlider : ();
			WikiForcedExpand : ();
			WikiSelect : ();
			WikiTimeline : ();
			PredefinedColor : (color : int);
			WikiRepeat : ();
			WikiComboBox : ();
			WikiRotate : ();
			WikiScale : ();
			WikiMutable : ();
			WikiTopModificator : (type : WriteTopModificator, size : WriteTopModificatorSize);
			MathNumber2SciNot : ();
			WikiPicButton : ();
			MathNumber2SigDig();
			WikiDebug();
			WikiBlank();
			WikiBlank2();
			WikiScoringIcon(type : WikiScoringIconType);
			WikiWhen(); //Syntax sugar: \when{cond}{body} => \select{Vars(cond)}{\if{cond}{body}}
			WikiUnderline2();
			WikiScore();
			WikiCase();
			WikiEmpty();
			WikiDraggable();
			WikiDroptarget();
			WikiPopup();
			WikiLimiter();
			WikiMessagesCollector();
			WikiRadioButtons();
			WikiInlineBullet();
			WikiNewLine();
			WikiCalc();
			WikiAltTextCollector();
			MathUnknownConstruction(text : string);

	supportedTeXLikeElements() -> [TeXLikeElement];

	supportedMathSymbolsRepresentations() -> [string];

	makeExtFormRef(name : string) -> string;
	WikiScoringIconType ::= WikiBlankAnswerType, WikiScoringMissing, WikiScoringFeedback;
		WikiBlankAnswerType ::= WikiScoringCorrect, WikiScoringAlmostCorrect, WikiScoringIncorrect;
			WikiScoringCorrect();
			WikiScoringAlmostCorrect();
			WikiScoringIncorrect();
		WikiScoringMissing();
		WikiScoringFeedback();
	getWikiScoringIconDescription(icon : WikiScoringIconType) -> WikiScoringIconDescription;
	WikiScoringIconDescription : (path : string, getScale : (double) -> Pair<double, double>, baseline : double, hideWhenDynamicTooltipIsEmpty : bool);

	WikiScoringVar : string = "$scored"; //Scoring icons are visible when the value is 1.

	getWikiSymbolsTree() -> Tree<int, string>;
}

extFromPrefix = "\\extform";

makeExtFormRef(name) {
	extFromPrefix + "{" + name + "}"
}

baseSupportedTeXLikeElementsCache : ref Maybe<[TeXLikeElement]> = ref None();

baseSupportedTeXLikeElements() { 
	onlyOnce(baseSupportedTeXLikeElementsCache, \ -> {

	topModificatorArgs = Some(WikiArgsDescription([RequiredArg(), OptionalArg(""), OptionalArg(""), OptionalArg("")]));

	[
	TeXLikeElement("\\sqrt", MathRoot(), Some(WikiArgsDescription([OptionalArg(" "), RequiredArg()]))),
	TeXLikeElement("\\frac", MathFrac(), Some(WikiArgsDescription([RequiredArg(), RequiredArg()]))),
	TeXLikeElement("\\brackets", MathBracket(), Some(WikiArgsDescription([OptionalArgBracket(), OptionalArgBracket(), RequiredArg()]))),
	TeXLikeElement("\\sum", MathSum(), Some(WikiArgsDescription([OptionalArg(""), OptionalArg(""), RequiredArg()]))),
	TeXLikeElement("\\product", MathProduct(), Some(WikiArgsDescription([OptionalArg(""), OptionalArg(""), RequiredArg()]))),
	TeXLikeElement("\\int", MathIntegral(), Some(WikiArgsDescription([OptionalArg(""), OptionalArg(""), RequiredArg()]))),
	TeXLikeElement("\\overscript", MathOverscript(), Some(WikiArgsDescription([RequiredArg(), RequiredArg()]))),
	TeXLikeElement("\\underscript", MathUnderscript(), Some(WikiArgsDescription([RequiredArg(), RequiredArg()]))),
	TeXLikeElement("\\dotted", MathDotted(), Some(WikiArgsDescription([RequiredArgDigit(), RequiredArgDigit(), RequiredArgDigit(), RequiredArgDigit(), OptionalArg(""), OptionalArg(""), RequiredArg()]))), // Special processing
	TeXLikeElement("\\longdivision", MathLongDivision(), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\if", ConditionalWiki(false), Some(WikiArgsDescription([RequiredArg(), RequiredArg(), OptionalArg("")]))),
	TeXLikeElement("\\if2", ConditionalWiki(true), Some(WikiArgsDescription([RequiredArg(), RequiredArg(), OptionalArg("")]))),
	TeXLikeElement("\\report", MathAssignmentsOnBecameVisible(), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\when", WikiWhen(), Some(WikiArgsDescription([RequiredArg(), RequiredArg(), OptionalArg("")]))),
	TeXLikeElement("\\score", WikiScore(), Some(WikiArgsDescription([OptionalArg(""), OptionalArg(""), RequiredArg(), OptionalArg(""), OptionalArg(""), OptionalArg("")]))),
	TeXLikeElement("\\case", WikiCase(), Some(WikiArgsDescription([RequiredArg(), OptionalArgsList()]))),
	TeXLikeElement("\\println", WikiDebug(), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\fillblank", WikiBlank(), Some(WikiArgsDescription([OptionalArg(""), OptionalArg(""), OptionalArg(""), OptionalArg(""), OptionalArg(""), RequiredArg(),  OptionalArgsList()]))),
	//The same as legacy \fillblank but without optional parameter for id. First char of each answer should be +/-/0 to specify score.
	TeXLikeElement("\\fillblank2", WikiBlank2(), Some(WikiArgsDescription([OptionalArg(""), OptionalArg(""), OptionalArg(""), OptionalArg(""), RequiredArg(),  OptionalArgsList()]))),
	TeXLikeElement("\\button", WikiButton(), Some(WikiArgsDescription([OptionalArg(""), RequiredArg(), RequiredArg()]))),
	TeXLikeElement("\\picbutton", WikiPicButton(), Some(WikiArgsDescription([RequiredArg(), OptionalArg(""), OptionalArg(""), RequiredArg()]))),
	TeXLikeElement("\\strike", MathStrike(), Some(WikiArgsDescription([OptionalArg(""), OptionalArg(""), RequiredArg(), OptionalArg("")]))),
	TeXLikeElement("\\underline", WikiUnderline2(), Some(WikiArgsDescription([OptionalArg(""), OptionalArg(""), OptionalArg(""), RequiredArg()]))),
	TeXLikeElement("\\slider", WikiSlider(), Some(WikiArgsDescription([RequiredArg(), RequiredArg(), RequiredArg(), RequiredArg(), OptionalArg("")]))),
	TeXLikeElement("\\expand", WikiForcedExpand(), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\select", WikiSelect(), Some(WikiArgsDescription([RequiredArg(), RequiredArg()]))),
	TeXLikeElement("\\timeline", WikiTimeline(), Some(WikiArgsDescription([RequiredArg(), OptionalArg(""), RequiredArg(), RequiredArg(), OptionalArg("")]))),
	TeXLikeElement("\\repeat", WikiRepeat(), Some(WikiArgsDescription([RequiredArg(), RequiredArg()]))),
	TeXLikeElement("\\combobox", WikiComboBox(), Some(WikiArgsDescription([OptionalArg(""), OptionalArg(""),RequiredArg(), OptionalArgsList()]))),
	TeXLikeElement("\\radiobuttons", WikiRadioButtons(), Some(WikiArgsDescription([OptionalArg(""),OptionalArg(""),OptionalArg(""), RequiredArg(), OptionalArgsList()]))),
	TeXLikeElement("\\draggable", WikiDraggable(), Some(WikiArgsDescription([RequiredArg(), OptionalArg(""), OptionalArg(""), RequiredArg(), OptionalArg(""), OptionalArg(""), OptionalArg(""), OptionalArg("")]))),
	TeXLikeElement("\\droptarget", WikiDroptarget(), Some(WikiArgsDescription([RequiredArg(), OptionalArg(""), OptionalArg(""), RequiredArg(), OptionalArg(""), OptionalArg(""), OptionalArg(""), OptionalArg("")]))),
	TeXLikeElement("\\popup", WikiPopup(), Some(WikiArgsDescription([OptionalArg(""), OptionalArg(""), RequiredArg(), RequiredArg(), RequiredArg(), OptionalArg("")]))),
	TeXLikeElement("\\limiter", WikiLimiter(), Some(WikiArgsDescription([RequiredArg(), RequiredArg(), RequiredArg(), RequiredArg()]))),
	TeXLikeElement("\\msgcollector", WikiMessagesCollector(), Some(WikiArgsDescription([OptionalArg(""), RequiredArg(), OptionalArgsList()]))),
	TeXLikeElement("\\alttext", WikiAltTextCollector(), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\word", MathNumber2String(), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\scinot", MathNumber2SciNot(), Some(WikiArgsDescription([RequiredArg(),OptionalArg(""), OptionalArg("")]))),
	TeXLikeElement("\\sigdig", MathNumber2SigDig(), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\rotate", WikiRotate(), Some(WikiArgsDescription([RequiredArg(), RequiredArg()]))),
	TeXLikeElement("\\scale", WikiScale(), Some(WikiArgsDescription([RequiredArg(), RequiredArg()]))),
	TeXLikeElement("\\empty", WikiEmpty(), None()),
	TeXLikeElement("\\nowigi", WikiEmpty(), None()),
	TeXLikeElement(extFromPrefix, WikiMutable(), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\inductor", CustomSymbol(CustomSymbolInductor()), None()),
	TeXLikeElement("\\capacitor", CustomSymbol(CustomSymbolCapacitor()), None()),
	TeXLikeElement("\\diode", CustomSymbol(CustomSymbolDiode()), None()),
	TeXLikeElement("\\resistor", CustomSymbol(CustomSymbolResistor()), None()),
	TeXLikeElement("\\dcsupply", CustomSymbol(CustomSymbolDcSupply()), None()),
	TeXLikeElement("\\acsupply", CustomSymbol(CustomSymbolAcSupply()), None()),
	TeXLikeElement("\\vec", WikiTopModificator(WriteModificatorArrow(), WriteModificatorFixed()), topModificatorArgs),
	TeXLikeElement("\\overright", WikiTopModificator(WriteModificatorArrow(), WriteModificatorStretch()), topModificatorArgs),
	TeXLikeElement("\\overline", WikiTopModificator(WriteModificatorLeftRightArrow(), WriteModificatorStretch()), topModificatorArgs),
	TeXLikeElement("\\hat", WikiTopModificator(WriteModificatorHat(), WriteModificatorFixed()), topModificatorArgs),
	TeXLikeElement("\\widehat", WikiTopModificator(WriteModificatorHat(), WriteModificatorStretch()), topModificatorArgs),
	TeXLikeElement("\\bar", WikiTopModificator(WriteModificatorBar(), WriteModificatorFixed()), topModificatorArgs),
	TeXLikeElement("\\overbar", WikiTopModificator(WriteModificatorBar(), WriteModificatorStretch()), topModificatorArgs),
	//	TeXLikeElement("\\arc", WikiTopModificator(WriteModificatorArc(), WriteModificatorFixed()), topModificatorArgs),
	TeXLikeElement("\\widearc", WikiTopModificator(WriteModificatorArc(), WriteModificatorStretch()), topModificatorArgs),
	TeXLikeElement("\\multisetu", MathSymbol("&#x228E;", [], MathMlOperator()), None()),
	TeXLikeElement("\\multisetm", MathSymbol("&#x228D;", [], MathMlOperator()), None()),
	TeXLikeElement("\\multiset", MathSymbol("&#x228C;", [], MathMlOperator()), None()),
	TeXLikeElement("\\Alpha", MathSymbol("&#x391;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\alpha", MathSymbol("&#x3B1;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Beta", MathSymbol("&#x392;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\beta", MathSymbol("&#x3B2;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Gamma", MathSymbol("&#x393;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\gamma", MathSymbol("&#x3B3;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Delta", MathSymbol("&#x394;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\delta", MathSymbol("&#x3B4;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Epsilon", MathSymbol("&#x395;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\epsilon", MathSymbol("&#x3B5;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Zeta", MathSymbol("&#x396;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\zeta", MathSymbol("&#x3B6;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Eta", MathSymbol("&#x397;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\eta", MathSymbol("&#x3B7;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Theta", MathSymbol("&#x398;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\theta", MathSymbol("&#x3B8;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Iota", MathSymbol("&#x399;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\iota", MathSymbol("&#x3B9;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Kappa", MathSymbol("&#x39A;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\kappa", MathSymbol("&#x3BA;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Lambda", MathSymbol("&#x39B;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\lambda", MathSymbol("&#x3BB;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Mu", MathSymbol("&#x39C;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\mu", MathSymbol("&#x3BC;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Nu", MathSymbol("&#x39D;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\nu", MathSymbol("&#x3BD;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Xi", MathSymbol("&#x39E;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\xi", MathSymbol("&#x3BE;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Omicron", MathSymbol("&#x39F;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\omicron", MathSymbol("&#x3BF;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Pi", MathSymbol("&#x3A0;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\pi", MathSymbol("&#x3C0;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Rho", MathSymbol("&#x3A1;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\rho", MathSymbol("&#x3C1;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Sigma", MathSymbol("&#x3A3;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\sigma", MathSymbol("&#x3C3;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Tau", MathSymbol("&#x3A4;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\tau", MathSymbol("&#x3C4;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\upsilon-bar", MathSymbol("&#8161;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Upsilon", MathSymbol("&#x3A5;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\upsilon", MathSymbol("&#x3C5;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Phi", MathSymbol("&#x3A6;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\phi", MathSymbol("&#x3C6;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Chi", MathSymbol("&#x3A7;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\chi", MathSymbol("&#x3C7;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Psi", MathSymbol("&#x3A8;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\psi", MathSymbol("&#x3C8;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Omega", MathSymbol("&#x3A9;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\omega", MathSymbol("&#x3C9;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\fstigma", MathSymbol("&#x3C2;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Aacute", MathSymbol("&#x00C1;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Abreve", MathSymbol("&#x0102;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Acirc", MathSymbol("&#x00C2;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Agrave", MathSymbol("&#x00C0;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Amacron", MathSymbol("&#x0100;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Atilde", MathSymbol("&#x00C3;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Auml", MathSymbol("&#x00C4;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ccedil", MathSymbol("&#x00C7;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Eacute", MathSymbol("&#x00C9;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ebreve", MathSymbol("&#x0114;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ecirc", MathSymbol("&#x00CA;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Egrave", MathSymbol("&#x00C8;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Emacron", MathSymbol("&#x0112;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Euml", MathSymbol("&#x00CB;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Etilde", MathSymbol("&#x1EBC;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Iacute", MathSymbol("&#x00CD;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ibreve", MathSymbol("&#x012C;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Icirc", MathSymbol("&#x00CE;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Igrave", MathSymbol("&#x00CC;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Imacron", MathSymbol("&#x012A;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Itilde", MathSymbol("&#x0128;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Iuml", MathSymbol("&#x00CF;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ntilde", MathSymbol("&#x00D1;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Oacute", MathSymbol("&#x00D3;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Obreve", MathSymbol("&#x014E;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ocirc", MathSymbol("&#x00D4;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ograve", MathSymbol("&#x00D2;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Omacron", MathSymbol("&#x014C;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Otilde", MathSymbol("&#x00D5;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ouml", MathSymbol("&#x00D6;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Uacute", MathSymbol("&#x00DA;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ubreve", MathSymbol("&#x016C;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ucirc", MathSymbol("&#x00DB;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ugrave", MathSymbol("&#x00D9;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Umacron", MathSymbol("&#x016A;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Utilde", MathSymbol("&#x0168;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Uuml", MathSymbol("&#x00DC;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Yacute", MathSymbol("&#x00DD;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ycirc", MathSymbol("&#x0176;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ygrave", MathSymbol("&#x1EF2;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\Ytilde", MathSymbol("&#x1EF8;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\aacute", MathSymbol("&#x00E1;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\abreve", MathSymbol("&#x0103;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\acirc", MathSymbol("&#x00E2;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\agrave", MathSymbol("&#x00E0;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\amacron", MathSymbol("&#x0101;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\atilde", MathSymbol("&#x00E3;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\auml", MathSymbol("&#x00E4;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ccedil", MathSymbol("&#x00E7;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\eacute", MathSymbol("&#x00E9;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ebreve", MathSymbol("&#x0115;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ecirc", MathSymbol("&#x00EA;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\egrave", MathSymbol("&#x00E8;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\emacron", MathSymbol("&#x0113;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\er", MathSymbol("&#602;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\etilde", MathSymbol("&#x1EBD;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\euml", MathSymbol("&#x00EB;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\iacute", MathSymbol("&#x00ED;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ibreve", MathSymbol("&#x012D;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\icirc", MathSymbol("&#x00EE;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\igrave", MathSymbol("&#x00EC;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\imacron", MathSymbol("&#x012B;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\itilde", MathSymbol("&#x0129;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\iuml", MathSymbol("&#x00EF;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ntilde", MathSymbol("&#x00F1;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\oacute", MathSymbol("&#x00F3;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\obreve", MathSymbol("&#x014F;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ocirc", MathSymbol("&#x00F4;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ograve", MathSymbol("&#x00F2;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\omacron", MathSymbol("&#x014D;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\otilde", MathSymbol("&#x00F5;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ouml", MathSymbol("&#x00F6;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\odot2", MathSymbol("&#x022F;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\schwa", MathSymbol("&#601;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\sh", MathSymbol("&#353;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\uacute", MathSymbol("&#x00FA;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ubreve", MathSymbol("&#x016D;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ucirc", MathSymbol("&#x00FB;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ugrave", MathSymbol("&#x00F9;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\umacron", MathSymbol("&#x016B;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\utilde", MathSymbol("&#x0169;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\uuml", MathSymbol("&#x00FC;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\udot", MathSymbol("u&#x0307;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\yacute", MathSymbol("&#x00FD;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ycirc", MathSymbol("&#x0177;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ygrave", MathSymbol("&#x1EF3;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\ytilde", MathSymbol("&#x1EF9;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\yuml", MathSymbol("&#x00FF;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\accent", MathSymbol("&#x00B4;", [], MathMlOperator()), None()),
	TeXLikeElement("\\accentsec", MathSymbol("&#x02DD;", [], MathMlOperator()), None()),
	TeXLikeElement("\\iexcl", MathSymbol("&#x00A1;", [], MathMlOperator()), None()),
	TeXLikeElement("\\iquest", MathSymbol("&#x00BF;", [], MathMlOperator()), None()),
	TeXLikeElement("\\downarrow", MathSymbol("&#x2193;", [], MathMlOperator()), None()),
	TeXLikeElement("\\Downarrow", MathSymbol("&#x21D3;", [], MathMlOperator()), None()),
	TeXLikeElement("\\gets", MathSymbol("&#x2190;", [], MathMlOperator()), None()),
	TeXLikeElement("\\hookleftarrow", MathSymbol("&#x21A9;", [], MathMlOperator()), None()),
	TeXLikeElement("\\hookrightarrow", MathSymbol("&#x21AA;", [], MathMlOperator()), None()),
	TeXLikeElement("\\leadsto", MathSymbol("&#x219D;", [], MathMlOperator()), None()),
	TeXLikeElement("\\Leftarrow", MathSymbol("&#x21D0;", [], MathMlOperator()), None()),
	TeXLikeElement("\\leftarrow", MathSymbol("&#x2190;", [], MathMlOperator()), None()),
	TeXLikeElement("\\leftharpoondown", MathSymbol("&#x21BD;", [], MathMlOperator()), None()),
	TeXLikeElement("\\leftharpoonup", MathSymbol("&#x21BC;", [], MathMlOperator()), None()),
	TeXLikeElement("\\leftrightarrow", MathSymbol("&#x2194;", [], MathMlOperator()), None()),
	TeXLikeElement("\\Leftrightarrow", MathSymbol("&#x21D4;", [], MathMlOperator()), None()),
	TeXLikeElement("\\leftrightharpoons", MathSymbol("&#x21CB;", [], MathMlOperator()), None()),
	TeXLikeElement("\\mapsto", MathSymbol("&#x21A6;", [], MathMlOperator()), None()),
	TeXLikeElement("\\nearrow", MathSymbol("&#x2197;", [], MathMlOperator()), None()),
	TeXLikeElement("\\nwarrow", MathSymbol("&#x2196;", [], MathMlOperator()), None()),
	TeXLikeElement("\\rightarrow", MathSymbol("&#x2192;", [], MathMlOperator()), None()),
	TeXLikeElement("\\Rightarrow", MathSymbol("&#x21D2;", [], MathMlOperator()), None()),
	TeXLikeElement("\\rightharpoondown", MathSymbol("&#x21C1;", [], MathMlOperator()), None()),
	TeXLikeElement("\\rightharpoonup", MathSymbol("&#x21C0;", [], MathMlOperator()), None()),
	TeXLikeElement("\\rightleftharpoons", MathSymbol("&#x21CC;", [], MathMlOperator()), None()),
	TeXLikeElement("\\searrow", MathSymbol("&#x2198;", [], MathMlOperator()), None()),
	TeXLikeElement("\\swarrow", MathSymbol("&#x2199;", [], MathMlOperator()), None()),
	TeXLikeElement("\\to", MathSymbol("&#x2192;", [], MathMlOperator()), None()),
	TeXLikeElement("\\Uparrow", MathSymbol("&#x21D1;", [], MathMlOperator()), None()),
	TeXLikeElement("\\uparrow", MathSymbol("&#x2191;", [], MathMlOperator()), None()),
	TeXLikeElement("\\Updownarrow", MathSymbol("&#x21D5;", [], MathMlOperator()), None()),
	TeXLikeElement("\\updownarrow", MathSymbol("&#x2195;", [], MathMlOperator()), None()),
	TeXLikeElement("\\lowset", MathSymbol("&#x02CC;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\aleph", MathSymbol("&#x2135;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\scripti", MathSymbol("i", [ScriptFont()], MathMlIdentifier()), None()),
	TeXLikeElement("\\scriptL", MathSymbol("&#x2112;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\scriptl", MathSymbol("&#x2113;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\scriptF", MathSymbol("&#x2131;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\scriptM", MathSymbol("&#8499;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\scriptP", MathSymbol("P", [ScriptFont()], MathMlIdentifier()), None()),
	TeXLikeElement("\\boldC", MathSymbol("&#x2102;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\boldN", MathSymbol("&#x2115;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\boldQ", MathSymbol("&#x211A;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\boldR", MathSymbol("&#x211D;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\boldZ", MathSymbol("&#x2124;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\scriptV", MathSymbol("V", [ScriptFont()], MathMlIdentifier()), None()),
	TeXLikeElement("\\~", ParagraphNbsp(), None()),
	TeXLikeElement("\\nbsp", ParagraphNbsp(), None()),
	TeXLikeElement("\\times", MathSymbol("&#215;", [], MathMlOperator()), None()),
	TeXLikeElement("\\cdot", MathSymbol("&#8901;", [], MathMlOperator()), None()),
	TeXLikeElement("\\div", CustomSymbol(CustomSymbolDiv()), None()),
	TeXLikeElement("\\qeq", CustomSymbol(CustomSymbolQuestionableEquals()), None()),
	TeXLikeElement("\\circ", MathSymbol("&#176;", [], MathMlOperator()), None()),
	TeXLikeElement("\\composition", MathSymbol("&#8728;", [], MathMlOperator()), None()),
	TeXLikeElement("\\pm", MathSymbol("&#177;", [NaturalMathFont()], MathMlOperator()), None()),
	TeXLikeElement("\\le", MathSymbol("&#8804;", [NaturalMathFont()], MathMlOperator()), None()),
	TeXLikeElement("\\ll", MathSymbol("&#x226A;", [], MathMlOperator()), None()),
	TeXLikeElement("\\ge", MathSymbol("&#8805;", [NaturalMathFont()], MathMlOperator()), None()),
	TeXLikeElement("\\gg", MathSymbol("&#x226B;", [], MathMlOperator()), None()),
	TeXLikeElement("\\neq", MathSymbol("&#8800;", [NaturalMathFont()], MathMlOperator()), None()),
	TeXLikeElement("\\equiv", MathSymbol("&#8801;", [], MathMlOperator()), None()),
	TeXLikeElement("\\propto", MathSymbol("&#8733;", [], MathMlOperator()), None()),
	TeXLikeElement("\\infty", MathSymbol("&#8734;", [], MathMlOperator()), None()),
	TeXLikeElement("\\approx", MathSymbol("&#8776;", [], MathMlOperator()), None()),
	TeXLikeElement("\\congruent", MathSymbol("&#8773;", [], MathMlOperator()), None()),
	TeXLikeElement("\\copyright", MathSymbol("&#xA9;", [], MathMlText()), None()),
	TeXLikeElement("\\hbarit", MathSymbol("&#x210F;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\hbar", MathSymbol("&#x127;", [], MathMlIdentifier()), None()),
	TeXLikeElement("\\neg", MathSymbol("&#xAC;", [], MathMlOperator()), None()),
	TeXLikeElement("\\box", MathSymbol("&#x25A1;", [], MathMlOperator()), None()),
	TeXLikeElement("\\fbox", MathSymbol("&#x25A0;", [], MathMlOperator()), None()),
	TeXLikeElement("\\textregistered", MathSymbol("&#xAE;", [], MathMlText()), None()),
	TeXLikeElement("\\forall", MathSymbol("&#x2200;", [], MathMlOperator()), None()),
	TeXLikeElement("\\exists", MathSymbol("&#x2203;", [], MathMlOperator()), None()),
	TeXLikeElement("\\oslash", MathSymbol("&#x2205;", [], MathMlOperator()), None()),
	TeXLikeElement("\\In", MathSymbol("&#x2208;", [], MathMlOperator()), None()),
	TeXLikeElement("\\NotIn", MathSymbol("&#x2209;", [], MathMlOperator()), None()),
	TeXLikeElement("\\in", MathSymbol("&#x220A;", [], MathMlOperator()), None()),
	TeXLikeElement("\\--", MathSymbol("&#x2014;", [], MathMlOperator()), None()),
	TeXLikeElement("\\emdash", MathSymbol("&#x2014;", [], MathMlOperator()), None()),
	TeXLikeElement("\\-", MathSymbol("&#x2013;", [], MathMlOperator()), None()),
	TeXLikeElement("\\endash", MathSymbol("&#x2013;", [], MathMlOperator()), None()),
	TeXLikeElement("\\dagger", MathSymbol("&#x2020;", [], MathMlOperator()), None()),
	TeXLikeElement("\\ddagger", MathSymbol("&#x2021;", [], MathMlOperator()), None()),
	TeXLikeElement("\\wedge", MathSymbol("&#x2227;", [], MathMlOperator()), None()),
	TeXLikeElement("\\vee", MathSymbol("&#x2228;", [], MathMlOperator()), None()),
	TeXLikeElement("\\cap", MathSymbol("&#x2229;", [], MathMlOperator()), None()),
	TeXLikeElement("\\cup", MathSymbol("&#x222A;", [], MathMlOperator()), None()),
	TeXLikeElement("\\oplus", MathSymbol("&#x2295;", [], MathMlOperator()), None()),
	TeXLikeElement("\\odot", MathSymbol("&#x2609;", [], MathMlOperator()), None()),
	TeXLikeElement("\\therefore", MathSymbol("&#x2234;", [], MathMlOperator()), None()),
	TeXLikeElement("\\supsetneq", MathSymbol("&#x228B;", [], MathMlOperator()), None()),
	TeXLikeElement("\\supseteq", MathSymbol("&#x2287;", [], MathMlOperator()), None()),
	TeXLikeElement("\\supset", MathSymbol("&#x2283;", [], MathMlOperator()), None()),
	TeXLikeElement("\\subsetneq", MathSymbol("&#x228A;", [], MathMlOperator()), None()),
	TeXLikeElement("\\subseteq", MathSymbol("&#x2286;", [], MathMlOperator()), None()),
	TeXLikeElement("\\subset", MathSymbol("&#x2282;", [], MathMlOperator()), None()),
	TeXLikeElement("\\sqsupseteq", MathSymbol("&#x2292;", [], MathMlOperator()), None()),
	TeXLikeElement("\\sqsupset", MathSymbol("&#x2290;", [], MathMlOperator()), None()),
	TeXLikeElement("\\sqsubseteq", MathSymbol("&#x2291;", [], MathMlOperator()), None()),
	TeXLikeElement("\\sqsubset", MathSymbol("&#x228F;", [], MathMlOperator()), None()),
	TeXLikeElement("\\sqcup", MathSymbol("&#x2294;", [], MathMlOperator()), None()),
	TeXLikeElement("\\sqcap", MathSymbol("&#x2293;", [], MathMlOperator()), None()),
	TeXLikeElement("\\notsupseteq", MathSymbol("&#x2289;", [], MathMlOperator()), None()),
	TeXLikeElement("\\notsupset", MathSymbol("&#x2285;", [], MathMlOperator()), None()),
	TeXLikeElement("\\notsubseteq", MathSymbol("&#x2288;", [], MathMlOperator()), None()),
	TeXLikeElement("\\notsubset", MathSymbol("&#x2284;", [], MathMlOperator()), None()),
	TeXLikeElement("\\angle", MathSymbol("&#x2220;", [], MathMlOperator()), None()),
	TeXLikeElement("\\mangle", MathSymbol("&#x2221;", [], MathMlOperator()), None()),
	TeXLikeElement("\\nabla", MathSymbol("&#x2207;", [], MathMlOperator()), None()),
	TeXLikeElement("\\otimes", MathSymbol("&#x2297;", [], MathMlOperator()), None()),
	TeXLikeElement("\\similar", MathSymbol("&#x223C;", [], MathMlOperator()), None()),
	TeXLikeElement("\\wtriangle", MathSymbol("&#x25B3;", [], MathMlOperator()), None()),
	TeXLikeElement("\\int", MathSymbol("&#x222B;", [], MathMlOperator()), None()),
	TeXLikeElement("\\oint", MathSymbol("&#x222E;", [], MathMlOperator()), None()),
	TeXLikeElement("\\iint", MathSymbol("&#x222C;", [], MathMlOperator()), None()),
	TeXLikeElement("\\oiint", MathSymbol("&#x222F;", [], MathMlOperator()), None()),
	TeXLikeElement("\\iiint", MathSymbol("&#x222D;", [], MathMlOperator()), None()),
	TeXLikeElement("\\oiiint", MathSymbol("&#x2230;", [], MathMlOperator()), None()),
	TeXLikeElement("\\circlearrowright", MathSymbol("&#x21BB;", [], MathMlOperator()), None()),
	TeXLikeElement("\\circlearrowleft", MathSymbol("&#x21BA;", [], MathMlOperator()), None()),
	TeXLikeElement("\\parallel", MathSymbol("&#x2225;", [], MathMlOperator()), None()),
	TeXLikeElement("\\perp", MathSymbol("&#x22A5;", [], MathMlOperator()), None()),
	TeXLikeElement("\\[", MathSymbol("[", [], MathMlOperator()), None()),
	TeXLikeElement("\\]", MathSymbol("]", [], MathMlOperator()), None()),
	TeXLikeElement("\\sup", MathSuperscript(), Some(WikiArgsDescription([RequiredArg(), RequiredArg()]))),
	TeXLikeElement("\\sub", MathSubscript(), Some(WikiArgsDescription([RequiredArg(), RequiredArg()]))),
	TeXLikeElement("\\subsup", WikiSubSup(), Some(WikiArgsDescription([RequiredArg(), RequiredArg(), RequiredArg(), OptionalArg("")]))),
	TeXLikeElement("\\u", MathUserSymbol(), None()),
	TeXLikeElement("\\U", UserSymbol(), None()),
	TeXLikeElement("\\red", PredefinedColor(0xD22D1D), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\scarlet", PredefinedColor(0xD22D1D), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\blue", PredefinedColor(0x0000FF), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\gray", PredefinedColor(0x909090), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\grey", PredefinedColor(0x909090), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\orange", PredefinedColor(0xDB5522), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\purple", PredefinedColor(0x8622B5), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\medium_green", PredefinedColor(0x008000), Some(WikiArgsDescription([RequiredArg()]))),
	TeXLikeElement("\\bullet", WikiInlineBullet(), None()),
	TeXLikeElement("\\newline", WikiNewLine(), None()),
	TeXLikeElement("\\calc", WikiCalc(), None()),
	TeXLikeElement("{", MathScript(), None()),
	TeXLikeElement("$", MathVariable(), None()),
	TeXLikeElement("`", MathNaturalSyntax(), None()),
];
	})
}

wikiSymbolsTreeCache : ref Maybe<Tree<int, string>> = ref None();

getWikiSymbolsTree() -> Tree<int, string> {
	onlyOnce(wikiSymbolsTreeCache, \ -> {
		fold(baseSupportedTeXLikeElements(), makeTree(), \acc, element -> {
			switch (element.type) {
				MathSymbol(encoding, __, __): {
					if (startsWith(encoding, "&#x")) {
						hex = strReplace(encoding, "&#x", "");
						setTree(acc, parseHex(hex), element.representation)
					} else if (startsWith(encoding, "&#")) {
						dec = strReplace(encoding, "&#", "");
						setTree(acc, s2i(dec), element.representation)
					} else acc
				}
				default: acc
			}
		})
	})
}

defaultIconScaling(baseMult : double) \fontSizeCoeff -> {
	scale = baseMult * fontSizeCoeff;
	Pair(scale, scale)
}

getWikiScoringIconDescription(type) {
	switch(type : WikiScoringIconType) {
		WikiScoringCorrect() : WikiScoringIconDescription("images/right2.png", defaultIconScaling(0.32), 40.0, false);
		WikiScoringAlmostCorrect() : WikiScoringIconDescription("images/almost_correct_reverse.png", defaultIconScaling(0.32), 40.0, false);
		WikiScoringIncorrect() : WikiScoringIconDescription("images/wrong2.png", defaultIconScaling(0.32), 40.0, false);
		WikiScoringMissing() : WikiScoringIconDescription("images/exclamation_mark.png", defaultIconScaling(0.32), 40.0, false);
		WikiScoringFeedback() : WikiScoringIconDescription("images/feedback_icon.png", defaultIconScaling(0.2475), 43.0, true);
	}
}


//if one string is a prefix of other then the one with less offset is used
supportedTeXLikeElementsCache : ref Maybe<[TeXLikeElement]> = ref None();
supportedTeXLikeElements() {
	onlyOnce(supportedTeXLikeElementsCache, \ -> {
		scoringIconsDescription = [
			Pair("\\correct", WikiScoringCorrect()),
			Pair("\\almostcorrect", WikiScoringAlmostCorrect()),
			Pair("\\incorrect", WikiScoringIncorrect()),
			Pair("\\missing", WikiScoringMissing()),
			Pair("\\feedback", WikiScoringFeedback())
		];

		// map(baseColorsList, \color -> color2name(color)) gives this result:
		baseColorNames = ["reddy brown", "tomato", "olive brown", "darkish green", "peacock blue", "blueberry", "cherry", "sun yellow", "dirty orange", "green", "dark sky blue", "faded purple", "white", "silver", "medium grey", "charcoal grey", "dark grey", "almost black", "black"];
		colorPickerColors = mapi(baseColorsList, \i, color -> TeXLikeElement("\\" + strReplace(baseColorNames[i], " ", "_"), PredefinedColor(color), Some(WikiArgsDescription([RequiredArg()]))));
		scoringIcons = map(scoringIconsDescription, \desc -> TeXLikeElement(desc.first, WikiScoringIcon(desc.second), Some(WikiArgsDescription([OptionalArg("")]))));

		concatA([colorPickerColors, baseSupportedTeXLikeElements(), scoringIcons]);
	})
}

supportedMathSymbolsRepresentations() { 
	map(
		supportedTeXLikeElements(),
		\me -> switch (me.type : TeXLikeExpression) {
			MathSymbol(encoding, style, type) : me.representation;
			default : "";
	}) |> \r -> filter(r, \v -> v != "");
}
