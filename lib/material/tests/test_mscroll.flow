import material/material2tropic;

main() {
	manager = makeMaterialManager([]);

	scrollContent =
		TFixed(800., 1800.)
		|> addTBackground(MGreen(200));

	spin = make(false);
	fpprint("spin")(spin);

	linesCount = 12;

	content =
		MScroll(
			scrollContent,
			TFillXY(),
			[
				TScrollCropByContent(),
				MScrollSpinner(spin, [
					MFill(MRed(900)),
					FillOpacity(0.5),
					MScrollSpinnerOffset(100., 80.),
					// MBezier(const(CubicBezierEasing(0.5, 0.5, 0.5, 0.5))), // linear animation
					MCustomSpinner(\draggingMouseY, iterationPrc, releasePrc, resetPrc ->
						generate(0, linesCount, \i ->
							MFrame(0., 2., [MFill(MCustomColor(0x69717d)), FillOpacity(i2d(i) / i2d(linesCount))], TFixed(12., 4.))
							|> MBorderLeft(12.)
							|> (\m -> MRotate(fselect(iterationPrc, FLift(\ip -> 
									360. / i2d(linesCount) * (1. + dfloor(ip * i2d(linesCount)) + i2d(i))
								)), m))
						)
						|> MGroup
						|> (\m -> MTranslate(const(Point(0., 50.)), m))
						|> (\m -> MShow(spin, m))
					)
				]),
				TScrollPercent(make(Point(0., 0.))),
			]
		)
		|> (\m -> MConstruct([makeSubscribe2(spin, \s -> if (s) timer(5000, \ -> nextDistinct(spin, false)))], m))
		|> MDebugPurple;

	mrender(manager, true, content);
}