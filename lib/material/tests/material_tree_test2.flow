import material/material_ui;

main() {
	manager = makeMaterialManager([]);
	expan = make(makeSet());
	sel = make(makeSet());

	mtree1 = MTree(
		const([
			makeTreeNodeHere(
				2,
				[MTreeNodeCustomExpander(\__, __, __, __ -> TEmpty(), \__, __ -> TEmpty())]
			)
		]),
		[
			MTreeSelection(make(makeSet())),
			MTreeExpanded(expan),
			MItemsLength(make(0)),
			MMultiSelection(sel)
		]
	);


	// makeSubscribe(expan, println)();

	mrender(manager, true, MScroll(mtree1, TFillXY(), []));

	// fail("0");
}

makeTreeNodeMaterial(expandedB : DynamicBehaviour<bool>) -> Material {
	MBaselineCols([
		MTextInput(make("content"), [], []),
		MTextButton("expand / collapse", \ -> reverseBehaviour(expandedB), [], [])
	])
};

makeTreeNodeHere(ch : int, style : [MTreeNodeStyle]) -> MTreeNode {
	expandedB = make(true);
	 MTreeNode(
		expandedB,
		makeTreeNodeMaterial,
		if (ch > 0)
			make(generate(0, 10, \__ -> makeTreeNodeHere(ch - 1, style)))
		else
			make([]),
		concat([
			MSelected(make(false)),
			MExpanded(expandedB),
			MChildSelected(make(false)),
		], style)
	);
} 
