import material/material2tropic;
import material/material_ui;
import mwigi/mw_wigify;

main() {
	manager = makeMaterialManager([]);

	items = [
		WigiStory(ref [WigiParagraph([WigiText("1", [])], [])], ref [], [ParagraphSpacing(3.0)]),
		WigiStory(ref [WigiParagraph([WigiText("2", [])], [])], ref [], [ParagraphSpacing(3.0)]),
		WigiStory(ref [WigiParagraph([WigiText("Text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text", [])], [])], ref [], [ParagraphSpacing(3.0)]),
		WigiStory(ref [WigiParagraph([WigiText("Text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text", [])], [])], ref [], [ParagraphSpacing(3.0)]),
	];

	makeRankAnswerView = \answer : WigiElement -> {
		hoverB = make(false);
		content = MAvailable(MBorderA(16.0, 0.0, 0.0, 16.0,
				MCopySize2(
					MWigify(
						answer,
						TFillXY(),
						[],
						[]
					),
					\size, c -> MScroll(c, MMinimumGroup2(size, TFillXY()), [])
				)
		), MGroup2(MMinimumGroup2(MFixedX(560.0), MFillX()), MFixedY(330.0)));

		MMouseDownAround(
			None(), make(false), hoverB, nop,
			MCopySize2(content, \size, c -> {
				MGroup2(
					MSelect(hoverB, \hover -> {
						TRectangle([MFill(if (hover) MGrey(300) else MGrey(100))], size)
					}) |> (\b -> MShadow(const(4.0), b)),
					MBorderA(0.0, 8.0, 0.0, 8.0, c)
				)
			})
		);
	};

	lines = map(items, \item -> MCustomLine(
		makeRankAnswerView(item),
		[MHeight(-1.0), MRippleType(make(MRippleFill()))]
	));

	dropSpot = MBorderBottom(16.0)(MCenterX(MFrame(0.0, 0.0, [MFill(MGrey(400))], TFixed(110.0, 3.0))));

	list = MList(lines, [], [MListReorder(make([]), const(true)), MGrabDelay(0), MReorderDropSpot(dropSpot), MHoverEnabled(const(false))]);

	mrender(manager, true, list)
}