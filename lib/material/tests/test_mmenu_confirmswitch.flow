import material/material2tropic;
import material/material_dialog;

main() {
	manager = makeMaterialManager([]);
	current = make(0);

	items = [
		MMenuSingleLine("Red", []),
		MMenuSingleLine("Green", []),
		MMenuSingleLine("Blue", []),
		MMenuSingleLine("Yellow", [])
	];

	// Simple confirmation that asks before changing selection
	confirmSwitch = MConfirmChange(\callback -> {
		close = make(false);

		ShowMDialog(
			manager,
			close,
			[
				MDialogTitle("Confirm Change"),
				MDialogUseFrame(),
				MDialogActions([
					MTextButton("YES", \ -> {
						next(close, true);
						callback(true);
					}, [], []),
					MTextButton("NO", \ -> {
						next(close, true);
						callback(false);
					}, [], [])
				])
			],
			MText("Change the color?", [])
		);
	});

	ui = MLines([
		MText("Select a color (with confirmation):", [MTitle()]),
		MBorder(0., 16., 0., 0., TEmpty()),
		MDropDownMenu(items, current, [MWidth(200.), confirmSwitch, /*MSingleSelectionToggle()*/]),
		MBorder(0., 16., 0., 0., TEmpty()),
		MSelect(current, \c ->
			MText("Selected: " + if (c >= 0 && c < length(items)) {
				switch (items[c]) {
					MMenuSingleLine(title, __): title;
					default: "";
				}
			} else "None", [MHeadline()])
		)
	])
	|> (\m -> MBorder(32., 32., 32., 32., m));

	mrender(manager, true, ui);
}
