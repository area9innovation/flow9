import material/material2tropic;
import material/material_ui;
import material/material_gui;

main() {
	mManager = makeMaterialManager([]);

	// Define 4 colored rectangles with their properties
	// Each item: Pair<color, name>
	rectangles = make([
		Pair(MRed(500), "Red"),
		Pair(MBlue(500), "Blue"),
		Pair(MGreen(500), "Green"),
		Pair(MYellow(500), "Yellow")
	]);

	// Button to move first rectangle to top (end of array = top of z-order)
	moveButton = MTextButton("Move First to Top", \ -> {
		current = getValue(rectangles);
		if (length(current) > 0) {
			first = current[0];
			rest = subrange(current, 1, length(current) - 1);
			newOrder = arrayPush(rest, first);
			println("Moving " + first.second + " to top");
			println("New order: " + strGlue(map(newOrder, \p -> p.second), ", "));
			next(rectangles, newOrder);
		}
	}, [], []);

	// Create the group of rectangles using SelectMGroup
	rectGroup = SelectMGroup(rectangles, \indexT, id, colorPair -> {
		colorName = colorPair.second;
		color = colorPair.first;
		
		// Position rectangles with offset so they overlap
		// Using stable id for position so rectangles don't jump around
		xOffset = i2d(id * 20);
		yOffset = i2d(id * 20);
		
		MOffset(xOffset, yOffset,
			MClickable(
				MRectangle([MFill(color)], MFixed(100.0, 100.0)),
				\ -> println("Clicked: " + colorName)
			)
		)
	});

	ui = MLines([
		MText("Click 'Move First to Top' then click in overlap region", []),
		MFixed(0.0, 10.0),
		moveButton,
		MFixed(0.0, 20.0),
		MGroup2(
			MFixed(200.0, 200.0),
			rectGroup
		)
	]);

	mrender(mManager, true, ui);
}
