import material/extra/filesystem/filesystem_extended_api;
import material/extra/filesystem/filesystem_extended_async_api;
import material/internal/filebrowser/material_filebrowser_internal_utils;

export {
	// Define the converter for "Files Paths" to "Material Preview"
	// Used to load all preview contents at once
	FbGetFilesPreview(fn : (filesPaths : [string], ([Pair<string, Material>]) -> void) -> void);
			
	// Filebrowser UI engine
	FilebrowserEngine<?, ??> ::= FilesystemExtAsyncAPI<?, ??>;

	convertExtApi2engine(
		api : FilesystemExtAPI,
		previewStyleM : Maybe<FbGetFilesPreview>,
		createFromNativesFnM : Maybe<([native]) -> void>
	) -> FilebrowserEngine<?, ??>;

	makeDummyFilebrowserEngine() -> FilebrowserEngine<?, ??>;
}

convertExtApi2engine(
	api : FilesystemExtAPI,
	previewStyleM : Maybe<FbGetFilesPreview>,
	createFromNativesFnM : Maybe<([native]) -> void>
) -> FilebrowserEngine<?, ??> {
	convertExtApi2asyncApi(
		api,
		maybeMap(previewStyleM, \previewStyle -> previewStyle.fn),
		createFromNativesFnM 
	);
}

makeDummyFilebrowserEngine() -> FilebrowserEngine<?, ??> {
	makeDummyFilesystemExtAsyncAPI("ERROR: Dummy engine");
}