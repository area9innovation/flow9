import math/math;
import net/url_parameter;

export {
	materialLog(s : string, level : MaterialLogLevel) -> void;
		MaterialLogLevel ::= MaterialError, MaterialWarning, MaterialInfo, MaterialDebug;
			MaterialError();
			MaterialWarning();
			MaterialInfo();
			MaterialDebug();

	materialLogFn(fn : () -> ?, level : MaterialLogLevel, defFn : () -> ?) -> ?;
}

debugMaterialLevel = s2i(getUrlParameterDef("debugMaterial", "0"));
debugMaterialEnabled = debugMaterialLevel > 0;

materialLog(s : string, level : MaterialLogLevel) -> void {
	materialLogFn(\ -> println(s), level, nop)
}

materialLogFn(fn : () -> ?, level : MaterialLogLevel, defFn : () -> ?) -> ? {
	if (debugMaterialEnabled) {
		switch (level) {
			MaterialError(): if (debugMaterialLevel > 0) fn() else defFn();
			MaterialWarning(): if (debugMaterialLevel > 1) fn() else defFn();
			MaterialInfo(): if (debugMaterialLevel > 2) fn() else defFn();
			MaterialDebug(): if (debugMaterialLevel > 3) fn() else defFn();
		}
	} else
		defFn()
}