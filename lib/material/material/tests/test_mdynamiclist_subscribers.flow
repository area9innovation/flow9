import material/material2tropic;

main() {
	manager = makeMaterialManager([]);

	chkCounter = make(0);
	subscribe(chkCounter, println);

	makeDynList = \ -> {
		b0 = make(enumFromTo(0, 2));

		b1 = 
			fmap(b0, \v -> 
				// MSingleLine("MSingleLine" + i2s(v), [/*MPrimaryAction(MIcon("alert", [])), MSecondaryAction(MIcon("alert", []))*/])
				MCustomLine(MText("MSingleLine" + i2s(v), [/*MPrimaryAction(MIcon("alert", [])), MSecondaryAction(MIcon("alert", []))*/]), [])
			);

		fpprint("B1 : ")(b1);

		timer(2000, \ -> dynArrayPush(b0, 3));
		// timer(4000, \ -> dynArrayPush(b0, 4));

		MDynamicList(
			fselect(b1, FLift(\v -> {
				println("CHK");
				next(chkCounter, getValue(chkCounter) + 1);
				v
			})), 
			[MCondensed(true), MEmptyMessage(MText("No values", [MListBody()])), MAddSeparators()], 
			[
				MItemsHeights(\__ -> const(40.))

			]
		)
	}

	listB = make(false);

	content = MLines2(
		MTextButton("Show", \ -> {println("_____________________"); next(chkCounter, 0); reverseBehaviour(listB)}, [], []),
		MSelect(listB, \b -> if (b) makeDynList() else MEmpty())
	)
	|> (\f -> mrender(manager, true, f));
}