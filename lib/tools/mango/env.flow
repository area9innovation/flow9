import tools/mango/mango_types;
import ds/tree;
import tools/poppy/poppy_interpreter;
// import seed/env;

export {
	makeMEnv(
		input : string,
		switchGrammar : (env : MEnv<?, ??>) -> MEnv<?, ??>,
		seedEnv : ??
	) -> MEnv<?, ??>;

	MEnv(
		// The string we are parsing
		input : string,
		// The rules
		names : Tree<string, Term>,
		// Poppy environment we use for the result stack
		poppy : PoppyEnv<?>,
		// The position in the input
		i : int,
		// Did parsing fail?
		fail : bool,
		// Function to switch to another parser
		switchGrammar : (env : MEnv<?, ??>) -> MEnv<?, ??>,
		// What is the longest we have parsed?
		maxi : int,

		// What errors did we get?
		errors : Tree<int, string>,
		// The runcore, parsers and switchers
		seedEnv : ??
	);
}

makeMEnv(
	input : string,
	switchGrammar : (env : MEnv<?, ??>) -> MEnv<?, ??>,
	seedEnv : ??
) -> MEnv<?, ??> {
	MEnv(
		input,
		makeTree(),
		makePoppyEnv(),
		0,
		false,
		switchGrammar,
		0,
		makeTree(),
		seedEnv
	);
}
