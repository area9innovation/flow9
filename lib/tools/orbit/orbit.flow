// Produced by  flowcpp mango/mango.flow -- file=orbit.mango compile=1 main=orbit_compiled linter=1
import tools/mango/mcode_lib;
import string;
import net/url_parameter;
import tools/orbit/orbit_compiled_parser;
import tools/orbit/orbit_types;
import tools/orbit/orbit_interpreter;
import tools/orbit/prettyprint;

main() {
	files = filtermap(getAllUrlParametersArray(), \a -> if (a[1] == "") Some(a[0]) else None());
	if (files == []) {
		println("Usage: orbit <file>");
	}
	errors = sum(map(files, \f -> {
		program = getFileContent(f);
		println(program);

		res : Pair<OrMath_expr, string> = parseCompiledMango(f, program, orbit_parse_orbit_compiled, flow(0));
		if (res.second != "") {
			println(f + ": " + res.second);
			1
		} else {
			println(prettyOrbit(res.first));
			val = interpretOrbit(emptyOrbEnv(), res.first);
			println("Result: " + prettyOrbit(val.result));
			0;
		}
	}));
	quit(errors);
}

