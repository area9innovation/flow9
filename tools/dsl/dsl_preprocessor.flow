import tools/dsl/registry/dsl_populate;
import tools/dsl/registry/dsl_parser;
import text/serialize;

serializeDslLanguages() -> void {
	setFileContent("dsl_serialized_languages.flow", 
		blueprint("
			import tools/dsl/dsl_language;

			export {
				getDslGrammars() -> Tree<string, DslGrammar>;
			}

			dslGrammarsM : ref Maybe<Tree<string, DslGrammar>> = ref None();

			getDslGrammars() -> Tree<string, DslGrammar> {
				onlyOnce(dslGrammarsM, \\ -> {
					%grammars%
				})
			}
",
			["grammars", serialize(tree2pairs(getDslGrammars()))]
		)
	);
	{}
}

main() {
    populateDsls();
    serializeDslLanguages();
    quit(0)
}
