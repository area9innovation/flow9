//import formats/json/json;
//import string;
//import math/stringmath;

native println2 : io (flow) -> void = Native.println;
native fold : (xs : [?], init : ??, fn : (??, ?)->??) -> ?? = Native.fold;
native i2s : (int) -> string = Native.i2s;
//native toString2 : io (v : ?) -> string = Native.toString2;
native toString2 : (flow) -> string = Native.toString;
native quit : io (code : int) -> void = Native.quit;

//a = ref "aaa";
test3_S(fld: int);

test3_Pair(first: ?, second: ??);

fact(i: int, acc: int) -> int {
	if (i == 0) acc else {
		fact(i - 1, i * acc);
	}
}

idfn(x: ?) -> ? { x }

test1_A(a: int, b: string, c: [int]);
test1_B(x: [int]);
test1_C(a: int);


test1() {
	zz = test1_B([1, 2, 3]);
	println2("A: " + toString2(zz.x));
	println2("1: '" + toString2(1) + "'");
	println2("true: '" + toString2(true) + "'");
	println2("2.78: '" + toString2(2.78) + "'");
	println2("\"AAA\": '" + toString2("AAA") + "'");

	println2("AAAA!!!!!!!!!!!!!!!---------------------");
	z = test1_A(2, "XXX00", [5, 6, 7]);
	println2("z='" + toString2(z) + "'");
	println2("z.b='" + toString2(z.b) + "'");
	println2("z.c='" + toString2(z.c) + "'");
	println2("[1, 2, 3]: '" + toString2([1, 2, 3]) + "'");
	println2("1=" + toString2(1));
	println2("END.");
}

main() {
	println2(i2s(
		fold([1], 
			test3_S(0), 
			\acc, x -> test3_S(x)
		).fld
	));
	println2(
		fold([test3_Pair(1, 2), test3_Pair(3, 4)], 0, \acc, x -> acc + x.first + x.second)
	);

	println2(i2s(fold([], test3_S(0), \acc, x -> test3_S(x)).fld));
	println2(fold([1], test3_S(0), \acc, x -> test3_S(x)).fld);
	println2(i2s(fold([1, 2], test3_S(0), \acc, x -> test3_S(x)).fld));
	
	x_AAA = test3_S(15);
	(\-> { println2(x_AAA); })();

	println2(fact(5, 1));
	
	z = test1_C(2);
	println2(z);
	println2(z);

	println2(z.a);
	
	x = "AAA";
	idfn(x);
	println2(x);

	quit(0);
}
