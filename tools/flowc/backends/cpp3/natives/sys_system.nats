[

Cpp3NativePlain("print", false,
"Void $F_1(print)(String s);\n",
"Void $F_1(print)(String s) {
	std::cout << s->toStd() << std::flush;
	s->decRC();
	return void_value;
}\n", "", [], []),

Cpp3NativePlain("readUntil", false,
"String $F_1(readUntil)(String str_pattern);\n",
"String $F_1(readUntil)(String str_pattern) {
	std::string pattern = str_pattern->toStd();
	str_pattern->decRC();
	std::ostringstream buffer;
	char ch = '\0';
	unsigned int pos = 0;
	while (std::cin.get(ch)) {
		buffer << ch;
		if (ch == pattern[pos]) {
			pos += 1;
			if (pos == pattern.size()) {
				return String::make(buffer.str());
			}
		} else {
			pos = 0;
		}
	}
}\n", "", [Cpp3Std(["<sstream>"], [])], []),

Cpp3NativePlain("getFileContentBinary", false,
"String $F_1(getFileContentBinary)(String path);\n",
"String $F_1(getFileContentBinary)(String path) {
	std::ifstream is(path->toStd(), std::ifstream::binary);
	path->decRC();
	if (is.is_open()) {
		/*
		// get length of file:
		is.seekg(0, is.end);
		int length = is.tellg();
		is.seekg(0, is.beg);
		char* buffer = new char [length];
		// read data as a block:
		is.read(buffer, length);
		*/
		std::stringstream buffer;
		buffer << is.rdbuf();
		if (is.good()) {
			return String::make(buffer.str());
		} else {
			return String::make();
		}
	} else {
		return String::make();
	}

	/*try {
		val bytes = java.nio.file.Files.readAllBytes(java.nio.file.Paths.get(name))
		return bytes.toString(Charsets.ISO_8859_1)
	} catch (e: java.io.IOException) {
		return \"\"
	}*/
}\n", "", [Cpp3Std(["<fstream>"], [])], []),

Cpp3NativePlain("setFileContentBytes", false,
"Bool $F_1(setFileContentBytes)(String path, String data);\n",
"Bool $F_1(setFileContentBytes)(String path, String data) {
	std::ofstream os(path->toStd(), std::ofstream::binary);
	path->decRC();
    os << data->toStd();
	data->decRC();
	return os.good();

	/*java.io.Writer? writer = null;
	try {
		writer = java.io.BufferedWriter(java.io.OutputStreamWriter(
			java.io.FileOutputStream(name), Charsets.ISO_8859_1)
		);
		val chars = CharArray(data.length, {i -> data.codePointAt(i).toChar() })
		writer.write(chars);
	} catch (ex: java.io.IOException) {
	} finally {
		try {
			writer.close();
			return true;
		} catch (_: java.lang.Exception) {
		}
	}
	return false*/
}\n", "", [Cpp3Std(["<fstream>"], [])], []),

Cpp3NativePlain("execSystemProcess", false,
"Int $F_1(execSystemProcess)(String command, Vec<String> args, String cwd, Fun<Void, String> onOut, Fun<Void, String> onErr);\n",
"Int $F_1(execSystemProcess)(String command, Vec<String> args, String cwd, Fun<Void, String> onOut, Fun<Void, String> onErr) {
	FlowProcess p(onOut, onErr);
	p.start(command, args, cwd, false);
	command->decRC();
	args->decRC();
	cwd->decRC();

	p.process->waitForFinished(-1);
	onOut->decRC();
	onErr->decRC();

	return p.process->exitCode();
}\n", "", [], ["sys_system"]),

Cpp3NativePlain("startProcess", false,
"Void $F_1(startProcess)(String command, Vec<String> args, String cwd, String stdin, Fun<Void, Int, String, String> onExit);\n",
"Void $F_1(startProcess)(String command, Vec<String> args, String cwd, String stdin, Fun<Void, Int, String, String> onExit) {
	FlowProcess p(onExit);
	p.writeStdin(stdin);
	stdin->decRC();

	p.start(command, args, cwd, false);
	command->decRC();
	args->decRC();
	cwd->decRC();

	p.process->waitForFinished(-1);
	onExit->decRC()
	;
	//p.nat->process->waitForStarted(-1);
	//std::cout << \"PROC STARTED\" << std::endl;
	//FlowProcess::running.insert(std::pair(p.nat.get(), p));
	//std::cout << \"FlowProcess::running.size(): \" << FlowProcess::running.size() << std::endl;
	return void_value;
}\n", "", [], ["sys_system"]),

Cpp3NativePlain("runSystemProcess", false,
"Native $F_1(runSystemProcess)(String command, Vec<String> args, String cwd, Fun<Void, String> onOut, Fun<Void, String> onErr, Fun<Void, Int> onExit);\n",
"Native $F_1(runSystemProcess)(String command, Vec<String> args, String cwd, Fun<Void, String> onOut, Fun<Void, String> onErr, Fun<Void, Int> onExit) {
	FlowProcess* p = new FlowProcess(onOut, onErr, onExit);
	
	p->start(command, args, cwd, false);
	command->decRC();
	args->decRC();
	cwd->decRC();

	// TODO: here we shouldn't wait until the process is finished!!!`
	p->process->waitForFinished(-1);
	onOut->decRC();
	onErr->decRC();
	onExit->decRC();

	//FlowProcess::running.insert(std::pair(p.nat.get(), p));
	return Native::make(p, [] (void* x) { delete static_cast<FlowProcess*>(x); });
}\n", "", [], ["sys_system"]),

Cpp3NativePlain("writeProcessStdin", false,
"Void $F_1(writeProcessStdin)(Native proc, String arg);\n",
"Void $F_1(writeProcessStdin)(Native proc, String arg) {
	proc->cast<FlowProcess>()->writeStdin(arg);
	proc->decRC();
	arg->decRC();
	return void_value;
}\n", "", [], ["sys_system"]),

Cpp3NativePlain("killSystemProcess", false,
"Void $F_1(killSystemProcess)(Native proc);\n",
"Void $F_1(killSystemProcess)(Native proc) {
	proc->cast<FlowProcess>()->process->kill();
	proc->decRC();
	//nat->processFinished(-100, QProcesS::CrashExit);
	return void_value;
}\n", "", [], ["sys_system"]),

Cpp3NativePlain("totalMemory", false,
"Double $F_1(totalMemory)();\n",
"Double $F_1(totalMemory)() {
	return 0.0; //max_heap_size;
}\n", "", [], []),

Cpp3NativePlain("freeMemory", false,
"Double $F_1(freeMemory)();\n",
"Double $F_1(freeMemory)() {
	return 0.0; //max_heap_size - allocated_bytes;
}\n", "", [], []),

Cpp3NativePlain("maxMemory", false,
"Double $F_1(maxMemory)();\n",
"Double $F_1(maxMemory)() {
	return 0.0; //max_heap_size;
}\n", "", [], [])


]