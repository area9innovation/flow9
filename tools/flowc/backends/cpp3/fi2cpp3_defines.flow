import tools/flowc/incremental/fi_helpers;
import tools/flowc/backends/common;

export {

Cpp3GlobalContext(
	config: FiCpp3Config,
	program: FiProgram,
	packagePath: string,
	structs2id: Tree<string, int>,
	typar2cpp: (FiTypeParameter) -> string,
	typename2cpp: (string) -> string,
	varname2cpp: (string) -> string,
	// Native functions definition and other information
	natives: Tree<string, CppNative>,
	// Parts of a shared runtime code
	runtimeParts: Tree<string, CppRuntimePart>,
	// Variables, which initialization happens in main function (i.e. cannot be static)
	volatileVars: Set<string>,
	// Code of volatile variables initialization
	volatileInit: ref [string],
	errors : ref [string]
);

CppNative(
	name: string,
	// Definition of native - it's c++ function implementation
	def: (Cpp3GlobalContext) -> string,
	// Possible inlining
	inline: Maybe<CppInline>,
	// External dependencies like <cmath>, which should be included like #include <cmath>
	include: [string],
	// Runtime dependencies on the common parts of runtime
	depends: [string]
);

CppInline(
	// construction of an inlined native call, first arg - call arguments, second arg - the type of a call
	def: ([string], FiTypeFunction) -> string,
);

CppRuntimePart(
	// The name of a runtime part - some natives may share the same parts,
	// so they depend on a name, rather then on a source itself
	name: string,
	// Global definitions of a runtime part
	global: string,
	// Possible initialization calls in main function
	main: string
);

}
