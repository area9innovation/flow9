native println2 : io (?) -> void = Native.println;

native map : ([?], (?) -> ??) -> [??] = Native.map;
native filter : (a : [?], test : (?) -> bool) -> [?] = Native.filter;
native fold : (xs : [?], init : ??, fn : (??, ?)->??) -> ?? = Native.fold;
native iter : ([?], (?)->void) -> void = Native.iter;

Struct1(i : int);
Struct2(fn : (?) -> bool);

// ------------------------------------------------------------------------------------------
foo1() -> void {
	dx = Struct1(10);
	fn1 = \v : Struct1 -> {
		j = dx.i;
		v.i + j;
	}
	map([Struct1(1), Struct1(2)], fn1);
	{}
}
// ------------------------------------------------------------------------------------------
foo2() -> void {
	dx = Struct1(10);
	map([Struct1(3), Struct1(2)], \v -> {
		j = dx.i;
		v.i + j;
	});
	{}
}
// ------------------------------------------------------------------------------------------
fn3(v : Struct1) -> int {
	v.i + 1;
}
foo3() -> void {
	map([Struct1(1), Struct1(2)], fn3);
	{}
}
// ------------------------------------------------------------------------------------------
foo4() -> void {
	dx = Struct1(10);
	fn2 = \v -> {
		j = dx.i;
		{}
	}
	iter([Struct1(1), Struct1(2)], fn2);
	{}
}
// ------------------------------------------------------------------------------------------
fn5(func : (int) -> int) -> void { }
foo5() -> void {
	dx = Struct1(1);
	innerFn = \i -> {
		x = dx.i;
		i + x;
	}
	fn5(innerFn);
	{}
}
// ------------------------------------------------------------------------------------------
idfn(v : int) -> int {v}
fn6(func6A : (int) -> int) -> void { 
	func6A(6);
	func6A(61);
	{}
}
foo6() -> void {
	dx = Struct1(1);
	innerFn = \i -> {
		x = dx.i;
		i + x;
	}
	fn6(innerFn);
	fn6(idfn);
	{}
}
// ------------------------------------------------------------------------------------------
fn71(func71 : (int) -> int) -> void {
	a = func71(15);
}
fn72(func72 : (int) -> int) -> void {
	a = func72(15);
	b = func72(16);
}
foo7() -> void {
	dx = Struct1(1);
	innerFn = \i -> {
		x = dx.i;
		i + x;
	}
	fn71(innerFn);
	fn72(innerFn);
	//dx;
	{}
}
// ------------------------------------------------------------------------------------------
foo8() -> void {
	sum = \m : int, n : int -> m + n;
	//(if (1>0) sum else sum)(1, 2); // TODO: error :(
	sum(1, 2);
	{}
}
// ------------------------------------------------------------------------------------------
foo9() -> void {
	x = Struct1(1);
	fn9 = \-> { x; {} }
	b = fn9;
	fn9();
	c = fn9;
	fn9();

	// a = println2; // TODO: error :(
	{}
}
// ------------------------------------------------------------------------------------------
foo10() -> void {
	dx = Struct1(10);
	b = Struct2(\i : int -> dx.i < 0);
	b.fn(1);
	{}
}
// ------------------------------------------------------------------------------------------
func11(v : int) -> void {

}
foo11() -> void {
	fn11 = \v : int, callback : (int) -> void -> callback(v);
	fn11(1, \k -> {});
	fn11(1, func11);
	{}
}
// ------------------------------------------------------------------------------------------
foo12() -> void {
	fn12 = \v -> v.i > 0;
	map([Struct1(1)], fn12);
	map([Struct1(1)], \v -> v.i < 0);
	{}
}
// ------------------------------------------------------------------------------------------
foo13() -> void {
	inc = \v : Struct1 -> {v2=v.i; {}}
	v = 1;
	{}
}
// ------------------------------------------------------------------------------------------
foo14() -> void {
	fn5(\v -> v);
	c = map([[Struct1(1)], [Struct1(-2)]], \arr -> map(arr, \v -> v.i > 0));
	{} 
}
// ------------------------------------------------------------------------------------------
foo15() -> void {
	dx = Struct1(10);
	fn1 = \v : Struct1 -> dx;
	{}
}
// ------------------------------------------------------------------------------------------
fn16_1(f : () -> void) -> void { }
fn16_2() -> void { }
foo16() -> void {
	fn16_1(fn16_2);
	fn16_1(fn16_2);
	{}
}
// ------------------------------------------------------------------------------------------
foo17() -> void {
	fn17_1 = \-> {
		fn1 = \j -> j + 3;
		fn1(2) + 1;
	}
	fn17_1();
	{}
}
// ------------------------------------------------------------------------------------------
foo18() -> void {
	fn18 = \v -> {}
	fn18(Struct1(180));
	{}
}
// ------------------------------------------------------------------------------------------
makeTrue(i : int) -> bool {
	true;
}
foo19() -> void {
	a = Struct2(makeTrue);
	a.fn(5);
	{}
}
foo20() -> void {
	afn = makeTrue;
	b = Struct2(afn);
	b.fn(6);
	b.fn(7);
	{}
}
// ------------------------------------------------------------------------------------------
foo21() -> void {
	a = Struct1(1);
	Struct1(2).i;
	{}

}
// ------------------------------------------------------------------------------------------
foo22() -> void {
	dx = Struct1(2);
	inc = \-> {dx.i; {} }
	inc();
}
// ------------------------------------------------------------------------------------------
foo23() -> void {
	afn = makeTrue;
	afn(6);
	afn(7);
	{}
}
// ------------------------------------------------------------------------------------------

main() {
	foo1();
	foo2();
	foo3();
	foo4();
	foo5();
	foo6();
	foo7();
	foo8();
	foo9();
	foo10();
	foo11();
	foo12(); 
	foo13();
	foo14();
	foo15(); 
	foo16();
	foo17();
	foo18();
	foo19();
	foo20();
	foo21();
	foo22();
	foo23();
	{}
}
