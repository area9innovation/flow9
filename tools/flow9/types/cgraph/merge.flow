import tools/flow9/types/cgraph/cgraph;
import tools/flow9/types/cgraph/pretty;

export {
	mergeCNodes(cmap : CMap, leftClass : int, left : CNode, rightClass : int, right : CNode, reason : ErrorReason) -> CNode;

	resolveCOverload(tmap : CMap, overloadClass : int, overload : COverload, other : CNode) -> bool;
}

mergeCNodes(cmap : CMap, leftClass : int, left : CNode, rightClass : int, right : CNode, reason : ErrorReason) -> CNode {
	if (right == CEpsilon()) left
	else if (left == CEpsilon() || right == left) right
	else {
		println("ERROR: WE should not be merging inside this monster");
		right;
	}
}

matchesEClasses(cmap : CMap, lclasses : [int], rclasses : [int]) -> bool {
	length(lclasses) == length(rclasses)
	&& forall(mapi(lclasses, \i, lc -> matchesEClass(cmap, lc, rclasses[i])), idfn)
}

matchesEClass(cmap : CMap, lclass : int, rclass : int) -> bool {
	l = getUnionMapValue(cmap.cmap, lclass);
	r = getUnionMapValue(cmap.cmap, rclass);
	matchesCNode(cmap, l, r)
}
