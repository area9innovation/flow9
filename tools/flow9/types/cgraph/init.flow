import tools/flow9/types/cgraph/cgraph;
import tools/flow9/types/cgraph/merge;

export {
	makeCMap() -> CMap;
}

makeCMap() -> CMap {
	self = ref None();
	cmap = CMap(
		makeUnionFindMap(CEpsilon(), \lc, l, rc, r, cookie : ErrorReason -> {
			switch (^self) {
				None(): {
					println("NOT SUPPOSED TO HAPPEN");
					l;
				}
				Some(s): mergeCNodes(s, lc, l, rc, r, cookie);
			}
		}),
		ref makeList()
	);

	self := Some(cmap);
	cmap;
}
